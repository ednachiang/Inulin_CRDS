---
title: "Code_AllShortReads"
author: "Edna Chiang"
date: "2/8/2022"
output: html_document
---

### Load Packages, scripts, and functions
```{r}
library(ggplot2)
library(plyr)
library(dplyr)
library(grid)
#library(MESS)
#library(pgirmess)
#library(Bolstad2)
library(phyloseq)
library(vegan)
#library(miLineage)
#library(psych)
library(car)
library(reshape2)
#source('scripts/import_crds.R')
#source('scripts/bin_crds.R')
source('scripts/misc.R')
#source('scripts/calc_delta_metrics.R')
source('scripts/simper_pretty.R')
source('scripts/R_krusk.R')
source('scripts/removeTaxa.R')
source('scripts/kaijuCreatePhyseq.R')
set.seed(1)
theme_set(theme_bw())
```



### DON'T RUN - Prepare taxonomic data
```{r}
### Remove taxa in < 3 samples
#removeTaxa('kaiju/all_shortreads/')

### Create phyloseq objects
#kaijuCreatePhyseq('kaiju/all_shortreads/', 'metadata_metag.csv')
```

### Load tax physeq data
```{r}
### Load physeq data
load("kaiju/all_shortreads/physeq/phylum.RData")
phy.phy <- physeq
load("kaiju/all_shortreads/physeq/class.RData")
cla.phy <- physeq
load("kaiju/all_shortreads/physeq/order.RData")
ord.phy <- physeq
load("kaiju/all_shortreads/physeq/family.RData")
fam.phy <- physeq
load("kaiju/all_shortreads/physeq/genus.RData")
gen.phy <- physeq
load("kaiju/all_shortreads/physeq/species.RData")
spe.phy <- physeq

### Melt physeq objects into dataframes
phy.melt <- psmelt(phy.phy)
cla.melt <- psmelt(cla.phy)
ord.melt <- psmelt(ord.phy)
fam.melt <- psmelt(fam.phy)
gen.melt <- psmelt(gen.phy)
spe.melt <- psmelt(spe.phy)


### Import metadata
meta <- read.csv('metadata_metag.csv', header=T)
meta$Season <- ordered(meta$Season, levels=c("Summer", "Winter", "Spring"))
```


### Summarize tax data
```{r}
phy.sum <- phy.melt %>%
  group_by(Season, OTU) %>%
  summarize(Mean = mean(Abundance),
            SD = sd(Abundance),
            SE = se(Abundance))
#write.csv(phy.sum, file = "kaiju/all_shortreads/phylum.sum.csv", row.names = F)

cla.sum <- cla.melt %>%
  group_by(Season, OTU) %>%
  summarize(Mean = mean(Abundance),
            SD = sd(Abundance),
            SE = se(Abundance))
#write.csv(cla.sum, file = "kaiju/all_shortreads/class.sum.csv", row.names = F)

ord.sum <- ord.melt %>%
  group_by(Season, OTU) %>%
  summarize(Mean = mean(Abundance),
            SD = sd(Abundance),
            SE = se(Abundance))
#write.csv(ord.sum, file = "kaiju/all_shortreads/order.sum.csv", row.names = F)

fam.sum <- fam.melt %>%
  group_by(Season, OTU) %>%
  summarize(Mean = mean(Abundance),
            SD = sd(Abundance),
            SE = se(Abundance))
#write.csv(fam.sum, file = "kaiju/all_shortreads/family.sum.csv", row.names = F)

gen.sum <- gen.melt %>%
  group_by(Season, OTU) %>%
  summarize(Mean = mean(Abundance),
            SD = sd(Abundance),
            SE = se(Abundance))
#write.csv(gen.sum, file = "kaiju/all_shortreads/genus.sum.csv", row.names = F)

spe.sum <- spe.melt %>%
  group_by(Season, OTU) %>%
  summarize(Mean = mean(Abundance),
            SD = sd(Abundance),
            SE = se(Abundance))
#write.csv(spe.sum, file = "kaiju/all_shortreads/species.sum.csv", row.names = F)
```