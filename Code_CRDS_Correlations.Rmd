---
title: "Code_TestCorrelations"
author: "Edna Chiang"
date: "12/14/2021"
output: html_document
---

### Load Packages, scripts, and functions
```{r}
library(ggplot2)
library(plyr)
library(dplyr)
library(grid)
library(car)
library(Rmisc)
library(confintr)
source('scripts/misc.R')
set.seed(1)
theme_set(theme_bw())
```

### Load Data
```{r}
load('crds.norm.RData')
load('crds.use.Rdata')
meta <- read.csv('metadata.csv')
```

### Prepare CRDS data
```{r}
# Add metadata
crds.use[, colnames(meta)[3:ncol(meta)]] <- NA
for(i in 1:nrow(crds.use)){
  meta.row <- which(meta$ID == crds.use$ID[i])
  crds.use[i, 7:ncol(crds.use)] <- meta[meta.row, 3:ncol(meta)]
}

# Calculate square root of AUC
crds.use$AUC <- as.numeric(crds.use$AUC)
minAUC <- min(crds.use$AUC)
crds.use$AUC_sqrt <- crds.use$AUC + (minAUC * -1)
crds.use$AUC_sqrt <- sqrt(crds.use$AUC_sqrt)

# Convert to numeric
crds.use$AvgD <- as.numeric(crds.use$AvgD)
crds.use$MaxD <- as.numeric(crds.use$MaxD)
crds.use$MaxSlope <- as.numeric(crds.use$MaxSlope)
crds.use$AUC <- as.numeric(crds.use$AUC)
crds.use$MaxD <- as.numeric(crds.use$MaxD)
crds.use$Baseline <- as.numeric(crds.use$Baseline)

# Order categorical variables
crds.use$Season <- ordered(crds.use$Season, levels = c("Summer", "Winter", "Spring"))
crds.use$Sex <- ordered(crds.use$Sex, levels = c("Female", "Male"))
crds.use$Antibiotics <- ordered(crds.use$Antibiotics, levels = c("No", "Yes"))
crds.use$Substrate <- ordered(crds.use$Substrate, levels = c("Inulin", "Saline"))
crds.use$Diet <- ordered(crds.use$Diet, levels = c("1", "2"))

# Remove outliers
crds.rem <- crds.use[-which(crds.use$ID == "S23"),]
crds.rem <- crds.rem[-which(crds.rem$ID == "S37"),]
crds.rem <- crds.rem[-which(crds.rem$ID == "S60"),]
crds.rem <- crds.rem[-which(crds.rem$ID == "W43"),]
crds.rem <- crds.rem[-which(crds.rem$ID == "W20"),]
  # This is due to odd metagenome
crds.rem <- crds.rem[-which(crds.rem$ID == "W50"),]

# Separate by substrate
crds.inu <- crds.rem[which(crds.rem$Substrate == "Inulin"),]
crds.sal <- crds.rem[which(crds.rem$Substrate == "Saline"),]

# Separate by substrate + season
crds.inu.s <- crds.inu[which(crds.inu$Season == "Summer"),]
crds.inu.w <- crds.inu[which(crds.inu$Season == "Winter"),]
crds.inu.p <- crds.inu[which(crds.inu$Season == "Spring"),]
crds.sal.s <- crds.sal[which(crds.sal$Season == "Summer"),]
crds.sal.w <- crds.sal[which(crds.sal$Season == "Winter"),]
crds.sal.p <- crds.sal[which(crds.sal$Season == "Spring"),]

# Separate by substrate + ABX
crds.inu.noabx <- crds.inu[which(crds.inu$Antibiotics == "No"),]
crds.inu.abx <- crds.inu[which(crds.inu$Antibiotics == "Yes"),]
crds.sal.noabx <- crds.sal[which(crds.sal$Antibiotics == "No"),]
crds.sal.abx <- crds.sal[which(crds.sal$Antibiotics == "Yes"),]
```

### Decide variables
```{r}
res <- resid(lm(MaxD ~ MaxSlope, crds.rem))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # p = 2.133e-09
  # Not Normal
cor.test(crds.rem$MaxD, crds.rem$MaxSlope, method = "kendall")
  # p = < 2.2e-16
  # tau = 0.722807
ci_cor(crds.rem$MaxD, crds.rem$MaxSlope, method = "kendall", type = c("bootstrap"), R = 9999, boot_type = "bca")
  # 0.5654087 0.8133238 

res <- resid(lm(Baseline ~ MaxD, crds.rem))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # p = 0.000537
  # Not Normal
cor.test(crds.rem$Baseline, crds.rem$MaxD, method = "kendall")
  # p = 0.3023
  # tau = -0.08075845 
ci_cor(crds.rem$Baseline, crds.rem$MaxD, method = "kendall", type = c("bootstrap"), R = 9999, boot_type = "bca")
  # -0.25125364  0.08590749 

res <- resid(lm(Baseline ~ MaxSlope, crds.rem))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # p = 0.0005308
  # Not Normal
cor.test(crds.rem$Baseline, crds.rem$MaxSlope, method = "kendall")
  # p = 0.1672
  # tau = -0.1081461 
ci_cor(crds.rem$Baseline, crds.rem$MaxSlope, method = "kendall", type = c("bootstrap"), R = 9999, boot_type = "bca")
  # -0.26621859  0.04679773 


res <- resid(lm(BodyMass ~ BodyTemp, crds.rem))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
cor.test(crds.rem$BodyMass, crds.rem$BodyTemp, method = "pearson")
  # p = 0.01144
  # CI = -0.4827085 -0.0676134
  # cor = -0.2886685
res <- resid(lm(BodyMass ~ Ketones, crds.rem))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
cor.test(crds.rem$BodyMass, crds.rem$Ketones, method = "pearson")
  # p = 5.863e-07
  # CI = -0.7323786 -0.3961947
  # cor = -0.5892281
res <- resid(lm(BodyTemp ~ Ketones, crds.rem))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
cor.test(crds.rem$BodyTemp, crds.rem$Ketones, method = "pearson")
  # p = 0.2677
  # CI = -0.3820908  0.1117377
  # cor = -0.1441388

## Go with Baseline, MaxSlope, & BodyMass
```

### Test Baseline
```{r}
### Test BodyMass Correlation

# Inulin No ABX
res <- resid(lm(BodyMass ~ Baseline, crds.inu.noabx))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # p = 0.04097
  # Not Normal
cor.test(crds.inu.noabx$BodyMass, crds.inu.noabx$Baseline, method = "kendall")
  # p = 0.0004751
  # tau = 0.5333333
ci_cor(crds.inu.abx$BodyMass, crds.inu.abx$Baseline, method = "kendall", type = c("bootstrap"), R = 9999, boot_type = "bca")
  # -0.02469136  0.70480694


# Inulin ABX
res <- resid(lm(BodyMass ~ Baseline, crds.inu.abx))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
cor.test(crds.inu.abx$BodyMass, crds.inu.abx$Baseline, method = "pearson")
  # p = 0.01336
  # CI = 0.1367106 0.8067164
  # cor = 0.5563719 


# Saline No ABX
res <- resid(lm(BodyMass ~ Baseline, crds.sal.noabx))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
cor.test(crds.sal.noabx$BodyMass, crds.sal.noabx$Baseline, method = "pearson")
  # p = 0.1602
  # CI = -0.1399968  0.6853107
  # cor = 0.3355493 


# Saline ABX
res <- resid(lm(BodyMass ~ Baseline, crds.sal.abx))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Test says normal, but residuals are sigmoid.
  # Not Normal
cor.test(crds.sal.abx$BodyMass, crds.sal.abx$Baseline, method = "kendall")
  # p = 0.0002925
  # tau = 0.6176471 
ci_cor(crds.sal.abx$BodyMass, crds.sal.abx$Baseline, method = "kendall", type = c("bootstrap"), R = 9999, boot_type = "bca")
  # 0.3658537 0.8095238 



p.adjust(c(0.0004751, 0.01336, 0.1602, 0.0002925), "BH")
  # 0.00095020 0.01781333 0.16020000 0.00095020
```


### Test MaxSlope
```{r}
### Test BodyMass Correlation

# Inulin No ABX
res <- resid(lm(BodyMass ~ MaxSlope, crds.inu.noabx))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # p = 0.0698
  # Not Normal
cor.test(crds.inu.noabx$BodyMass, crds.inu.noabx$MaxSlope, method = "kendall")
  # p = 0.006091
  # tau = 0.4285714
ci_cor(crds.inu.noabx$BodyMass, crds.inu.noabx$MaxSlope, method = "kendall", type = c("bootstrap"), R = 9999, boot_type = "bca")
  # 0.1959799 0.6218905 

# Inulin ABX
res <- resid(lm(BodyMass ~ MaxSlope, crds.inu.abx))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Borderline, but go with Normal
  # Normal
cor.test(crds.inu.abx$BodyMass, crds.inu.abx$MaxSlope, method = "pearson")
  # p = 0.5483
  # CI = -0.5635368  0.3292449
  # cor = -0.1469384

# Saline No ABX
res <- resid(lm(BodyMass ~ MaxSlope, crds.sal.noabx))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
cor.test(crds.sal.noabx$BodyMass, crds.sal.noabx$MaxSlope, method = "pearson")
  # p = 0.6134
  # CI = -0.5472759  0.3500475
  # cor = -0.1238539

# Saline ABX
res <- resid(lm(BodyMass ~ MaxSlope, crds.sal.abx))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # p = 0.002278
  # Only not normal because of 2 outliers
  # Normal
cor.test(crds.sal.abx$BodyMass, crds.sal.abx$MaxSlope, method = "pearson")
  # p = 0.6564
  # CI = -0.5654201  0.3858203
  # cor = -0.1164123



p.adjust(c(0.006091, 0.5483, 0.6134, 0.6564), "BH")
  # 0.024364 0.656400 0.656400 0.656400
```




### Load/Test Inulinase RPKG
```{r}
### Exo - RPKG
exo_rpkg <- read.csv('eCAMI/inulinase/exoRPKG.csv')
exo_rpkg$Season <- ordered(exo_rpkg$Season, c("Summer", "Winter", "Spring"))

# Remove W20 outlier
exo_rpkg <- exo_rpkg[-which(exo_rpkg$Sample == "S-W20"),]


### Prepare AUC & slope data
for(sample in 1:nrow(exo_rpkg)){
  sampName <- substr(exo_rpkg$Sample[sample], 3, 5)
  useRow <- which(crds.rem$ID == sampName)
  exo_rpkg$Baseline[sample] <- crds.rem$Baseline[useRow]
  exo_rpkg$AUC_sqrt[sample] <- crds.rem$AUC_sqrt[useRow]
  exo_rpkg$AvgD[sample] <- crds.rem$AvgD[useRow]
  exo_rpkg$MaxD[sample] <- crds.rem$MaxD[useRow]
  exo_rpkg$MaxSlope[sample] <- crds.rem$MaxSlope[useRow]
}

# Subset out inulin samples
exo_rpkg_inu <- exo_rpkg[1:9,]


# Test RPKG - Baseline
res <- resid(lm(Baseline ~ RPKG, exo_rpkg_inu))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
cor.test(exo_rpkg_inu$Baseline, exo_rpkg_inu$RPKG, method = "pearson")
  # p = 0.9096
  # CI = -0.6385148  0.6882598
  # cor = 0.04446048

# Test RPKG - MaxSlope
res <- resid(lm(MaxSlope ~ RPKG, exo_rpkg_inu))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
cor.test(exo_rpkg_inu$MaxSlope, exo_rpkg_inu$RPKG, method = "pearson")
  # p = 0.9127
  # CI = -0.6874511  0.6394231
  # cor = -0.04292835 
```


### Load/Test DNA Yield
```{r}
# Load DNA data
dna <- read.csv('dna.csv')
dna$Season <- ordered(dna$Season, levels=c("Summer", "Winter", "Spring"))
dna <- dna[-which(dna$Squirrel == "S23"),]
dna <- dna[-which(dna$Squirrel == "S37"),]
dna <- dna[-which(dna$Squirrel == "S60"),]
dna <- dna[-which(dna$Squirrel == "W43"),]
dna <- dna[-which(dna$Squirrel == "W20"),]
#dna <- dna[-which(dna$Squirrel == "W53"),]
dna <- dna[-which(dna$Squirrel == "P04"),]
dna <- dna[-which(dna$Squirrel == "S11"),]
dna <- dna[-which(dna$Squirrel == "S40"),]
dna <- dna[-which(dna$Squirrel == "W50"),]
dna.con <- dna[which(substr(dna$Sample,2,2) == "C"),]


### Add in delta metrics
for(sample in 1:nrow(dna.con)){
  sampName <- dna.con$Squirrel[sample]
  useRow <- which(crds.rem$ID == sampName)
  dna.con$Baseline[sample] <- crds.rem$Baseline[useRow]
  dna.con$AUC_sqrt[sample] <- crds.rem$AUC_sqrt[useRow]
  dna.con$AvgD[sample] <- crds.rem$AvgD[useRow]
  dna.con$MaxD[sample] <- crds.rem$MaxD[useRow]
  dna.con$MaxSlope[sample] <- crds.rem$MaxSlope[useRow]
}

# Subset out inulin
dna.c.inu <- dna.con[which(dna.con$Substrate == "Inulin"),]

# Subset out ABX treatments
dna.c.inu.abx <- dna.c.inu[which(dna.c.inu$Antibiotics == "Antibiotics"),]
dna.c.inu.noabx <- dna.c.inu[which(dna.c.inu$Antibiotics == "No Antibiotics"),]



### Test Baseline
res <- resid(lm(DNA_Yield_.ng.mg. ~ Baseline, dna.c.inu.noabx))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
cor.test(dna.c.inu.noabx$DNA_Yield_.ng.mg., dna.c.inu.noabx$Baseline, method = "pearson")
  # p = 0.3841
  # CI = -0.5816553  0.2533366
  # cor = -0.2002499 

res <- resid(lm(DNA_Yield_.ng.mg. ~ Baseline, dna.c.inu.abx))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # p = 0.03934
  # Not Normal
cor.test(dna.c.inu.abx$DNA_Yield_.ng.mg., dna.c.inu.abx$Baseline, method = "kendall")
  # p = 0.04198
  # tau = -0.3421963
ci_cor(dna.c.inu.abx$DNA_Yield_.ng.mg., dna.c.inu.abx$Baseline, method = "kendall", type = c("bootstrap"), R = 9999, boot_type = "bca")
  # -0.6457419  0.1401161 


### Test MaxSlope
res <- resid(lm(DNA_Yield_.ng.mg. ~ MaxSlope, dna.c.inu.noabx))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
cor.test(dna.c.inu.noabx$DNA_Yield_.ng.mg., dna.c.inu.noabx$MaxSlope, method = "pearson")
  # p = 0.4263
  # CI = -0.2697019  0.5699128
  # cor = 0.1833294 

res <- resid(lm(DNA_Yield_.ng.mg. ~ MaxSlope, dna.c.inu.abx))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # p = 0.002416
  # Not Normal
cor.test(dna.c.inu.abx$DNA_Yield_.ng.mg., dna.c.inu.abx$MaxSlope, method = "kendall")
  # p = 0.05829
  # tau = 0.3185965
ci_cor(dna.c.inu.abx$DNA_Yield_.ng.mg., dna.c.inu.abx$MaxSlope, method = "kendall", type = c("bootstrap"), R = 9999, boot_type = "bca")
  # -0.07955287  0.55564849




p.adjust(c(0.3841, 0.04198, 0.4263, 0.05829), "BH")
  # 0.42630 0.11658 0.42630 0.11658

```


### Hib Dates
```{r}
### Load data ###

# Dates
dates <- read.csv('metadata_dates.csv')
dates_use <- dates[-which(dates$Season == "Summer"),]
rownames(dates_use) <- 1:nrow(dates_use)
dates_use <- dates_use[-13:-28,]
rownames(dates_use) <- 1:nrow(dates_use)
dates_use <- dates_use[-33:-40,]
dates_use <- dates_use[-3,]
  # Remove outlier P04
dates_use <- dates_use[-which(dates_use$ID == "W20"),]



# Add CRDS metrics
for(k in 1:nrow(dates_use)){
  ID <- dates_use$ID[k]
  rowUse <- which(crds.rem$ID == ID)
  dates_use$AvgD[k] <- crds.rem$AvgD[rowUse]
  dates_use$MaxD[k] <- crds.rem$MaxD[rowUse]
  dates_use$MaxSlope[k] <- crds.rem$MaxSlope[rowUse]
  dates_use$AUC_sqrt[k] <- crds.rem$AUC_sqrt[rowUse]
  dates_use$Baseline[k] <- crds.rem$Baseline[rowUse]
}



# Separate by Substrate
dates.inu <- dates_use[which(dates_use$Substrate == "Inulin"),]
dates.sal <- dates_use[which(dates_use$Substrate == "Saline"),]

# Separate by Substrate + Season
dates.inu.p <- dates.inu[which(dates.inu$Season == "Spring"),]
dates.inu.w <- dates.inu[which(dates.inu$Season == "Winter"),]
dates.sal.p <- dates.sal[which(dates.sal$Season == "Spring"),]
dates.sal.w <- dates.sal[which(dates.sal$Season == "Winter"),]

# Check variables for cross-correlations
dates_use_check <- dates_use[which(dates_use$ID != "P19"),]
dates_use_check <- dates_use_check[which(dates_use_check$ID != "W41"),]
res <- resid(lm(Days_Hib ~ IBA.Hib, dates_use_check))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Test is borderline
  # p = 0.06271
  # Not Normal
cor.test(dates_use_check$Days_Hib, dates_use_check$IBA.Hib, method = "kendall")
  # p-value = 1
  # tau = 0



### Correlate Baseline ### 

# Inulin Winter
res <- resid(lm(Days_Hib ~ Baseline, dates.inu.w))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # p = 0.04767
  # Not Normal
cor.test(dates.inu.w$Days_Hib, dates.inu.w$Baseline, method = "pearson")
  # p-value = 0.8616
  # CI = -0.7005837  0.6242007
  # cor = -0.0681881 

res <- resid(lm(IBA.Hib ~ Baseline, dates.inu.w))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
cor.test(dates.inu.w$IBA.Hib, dates.inu.w$Baseline, method = "pearson")
  # p-value = 0.6949
  # CI = -0.7416104  0.5691438
  # cor = -0.1526929 


# Inulin Spring
res <- resid(lm(Days_Hib ~ Baseline, dates.inu.p))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
cor.test(dates.inu.p$Days_Hib, dates.inu.p$Baseline, method = "pearson")
  # p-value = 0.09606
  # CI = -0.2515161  0.9870016
  # cor = 0.8106333 

res <- resid(lm(IBA.Hib ~ Baseline, dates.inu.p))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
cor.test(dates.inu.p$IBA.Hib, dates.inu.p$Baseline, method = "pearson")
  # p-value = 0.5982
  # CI = -0.7829395  0.9377288
  # cor = 0.3211981 


# Saline Winter
res <- resid(lm(Days_Hib ~ Baseline, dates.sal.w))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
cor.test(dates.sal.w$Days_Hib, dates.sal.w$Baseline, method = "pearson")
  # p-value = 5.622e-05
  # CI = -0.9858039 -0.7568553
  # cor = -0.9390097

res <- resid(lm(IBA.Hib ~ Baseline, dates.sal.w))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
cor.test(dates.sal.w$IBA.Hib, dates.sal.w$Baseline, method = "pearson")
  # p-value = 0.9251
  # CI = -0.6842065  0.6430302
  # cor = -0.03681214 



# Saline Spring
res <- resid(lm(Days_Hib ~ Baseline, dates.sal.p))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
cor.test(dates.sal.p$Days_Hib, dates.sal.p$Baseline, method = "pearson")
  # p-value = 0.172
  # CI = -0.3585561  0.9551933
  # cor = 0.6389266 

res <- resid(lm(IBA.Hib ~ Baseline, dates.sal.p))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
cor.test(dates.sal.p$IBA.Hib, dates.sal.p$Baseline, method = "pearson")
  # p-value = 0.6928
  # CI = -0.8134565  0.9267202
  # cor = 0.2437349 



# Days_Hib ~ Baseline
p.adjust(c(0.8616, 0.09606, 5.622e-05, 0.172), "BH")
  # 0.86160000 0.19212000 0.00022488 0.22933333

# IBA.Hib ~ Baseline
p.adjust(c(0.6949, 0.5982, 0.9251, 0.6928), "BH")
  # 0.9251 0.9251 0.9251 0.9251



### Correlate MaxSlope ### 

# Inulin Winter
res <- resid(lm(Days_Hib ~ MaxSlope, dates.inu.w))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # p = 0.04767
  # Not Normal
cor.test(dates.inu.w$Days_Hib, dates.inu.w$MaxSlope, method = "kendall")
  # p-value = 0.3454
  # tau = 0.2535463
ci_cor(dates.inu.w$Days_Hib, dates.inu.w$MaxSlope, method = "kendall", type = c("bootstrap"), R = 9999, boot_type = "bca")
  # -0.5315096  0.7500000 

res <- resid(lm(IBA.Hib ~ MaxSlope, dates.inu.w))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
cor.test(dates.inu.w$IBA.Hib, dates.inu.w$MaxSlope, method = "pearson")
  # p-value = 0.4296
  # CI = -0.8047344  0.4529456
  # cor = -0.3020301 



# Inulin Spring
res <- resid(lm(Days_Hib ~ MaxSlope, dates.inu.p))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
cor.test(dates.inu.p$Days_Hib, dates.inu.p$MaxSlope, method = "pearson")
  # p-value = 0.7633
  # CI = -0.9178319  0.8326501
  # cor = -0.1869628

res <- resid(lm(IBA.Hib ~ MaxSlope, dates.inu.p))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
cor.test(dates.inu.p$IBA.Hib, dates.inu.p$MaxSlope, method = "pearson")
  # p-value = 0.6705
  # CI = -0.9293996  0.8068176
  # cor = -0.2618188


# Saline Winter
res <- resid(lm(Days_Hib ~ MaxSlope, dates.sal.w))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
cor.test(dates.sal.w$Days_Hib, dates.sal.w$MaxSlope, method = "pearson")
  # p-value = 0.3965
  # CI = -0.4046253  0.7827478
  # cor = 0.3019186 

res <- resid(lm(IBA.Hib ~ MaxSlope, dates.sal.w))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
cor.test(dates.sal.w$IBA.Hib, dates.sal.w$MaxSlope, method = "pearson")
  # p-value = 0.9288
  # CI = -0.6832444  0.6440887
  # cor = -0.0350077 



# Saline Spring
res <- resid(lm(Days_Hib ~ MaxSlope, dates.sal.p))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
cor.test(dates.sal.p$Days_Hib, dates.sal.p$MaxSlope, method = "pearson")
  # p-value = 0.4402
  # CI = -0.6142233  0.9133714
  # cor = 0.3934797 

res <- resid(lm(IBA.Hib ~ MaxSlope, dates.sal.p))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
cor.test(dates.sal.p$IBA.Hib, dates.sal.p$MaxSlope, method = "pearson")
  # p-value = 0.7359
  # CI =  -0.8254998  0.9213618
  # cor = 0.2089396 



# Days_Hib ~ MaxSlope
p.adjust(c(0.3454, 0.7633, 0.3965, 0.4402), "BH")
  # 0.5869333 0.7633000 0.5869333 0.5869333

# IBA.Hib ~ MaxSlope
p.adjust(c(0.4296, 0.6705, 0.9288, 0.7359), "BH")
  # 0.9288 0.9288 0.9288 0.9288






### Combine RPKG + Hib Dates ###
rpkg.dates <- exo_rpkg[which(exo_rpkg$Season != "Summer"),]

for(m in 1:nrow(rpkg.dates)){
  ID <- substr(rpkg.dates$Sample, 3, 5)[m]
  
  useRow <- which(dates_use$ID == ID)
  rpkg.dates$Days_Hib[m] <- dates_use$Days_Hib[useRow]
  rpkg.dates$IBA.Hib[m] <- dates_use$IBA.Hib[useRow]
  rpkg.dates$Num_IBA[m] <- dates_use$Num_IBA[useRow]
}

# Separate by Season
rpkg.dates.w <- rpkg.dates[which(rpkg.dates$Season == "Winter"),]
rpkg.dates.p <- rpkg.dates[which(rpkg.dates$Season == "Spring"),]



### Correlate RPKG w/ Hib Dates ###
res <- resid(lm(Days_Hib ~ RPKG, rpkg.dates.w))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
cor.test(rpkg.dates.w$Days_Hib, rpkg.dates.w$RPKG, method = "pearson")
  # p-value = 0.5756
  # CI = -0.9402272  0.7746305
  # cor = -0.3400072 

res <- resid(lm(IBA.Hib ~ RPKG, rpkg.dates.w))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
cor.test(rpkg.dates.w$IBA.Hib, rpkg.dates.w$RPKG, method = "pearson")
  # p-value = 0.6959
  # CI = -0.9263363  0.8143722
  # cor = -0.2411816 


res <- resid(lm(Days_Hib ~ RPKG, rpkg.dates.p))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
cor.test(rpkg.dates.p$Days_Hib, rpkg.dates.p$RPKG, method = "pearson")
  # p-value = 0.3231
  # CI = -0.5332439  0.9313537
  # cor = 0.490652 

res <- resid(lm(IBA.Hib ~ RPKG, rpkg.dates.p))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
cor.test(rpkg.dates.p$IBA.Hib, rpkg.dates.p$RPKG, method = "pearson")
  # p-value = 0.8018
  # CI = -0.8525207  0.7606957
  # cor = -0.1329302 



p.adjust(c(0.5756, 0.6959, 0.3231, 0.8018), "BH")
  # 0.8018 0.8018 0.8018 0.8018

```



