---
title: "Code_TestABX"
author: "Edna Chiang"
date: "12/14/2021"
output: html_document
---
### Load Packages, scripts, and functions
```{r}
library(ggplot2)
library(plyr)
library(dplyr)
library(grid)
library(car)
library(Rmisc)
library(boot)
library(simpleboot)
source('scripts/misc.R')
set.seed(1)
theme_set(theme_bw())
```

### Load Data
```{r}
load('crds.norm.RData')
load('crds.use.Rdata')
meta <- read.csv('metadata.csv')
```

### Prepare CRDS data
```{r}
# Add metadata
crds.use[, colnames(meta)[3:ncol(meta)]] <- NA
for(i in 1:nrow(crds.use)){
  meta.row <- which(meta$ID == crds.use$ID[i])
  crds.use[i, 7:ncol(crds.use)] <- meta[meta.row, 3:ncol(meta)]
}

# Calculate square root of AUC
crds.use$AUC <- as.numeric(crds.use$AUC)
minAUC <- min(crds.use$AUC)
crds.use$AUC_sqrt <- crds.use$AUC + (minAUC * -1)
crds.use$AUC_sqrt <- sqrt(crds.use$AUC_sqrt)

# Convert to numeric
crds.use$AvgD <- as.numeric(crds.use$AvgD)
crds.use$MaxD <- as.numeric(crds.use$MaxD)
crds.use$MaxSlope <- as.numeric(crds.use$MaxSlope)
crds.use$AUC <- as.numeric(crds.use$AUC)
crds.use$MaxD <- as.numeric(crds.use$MaxD)
crds.use$Baseline <- as.numeric(crds.use$Baseline)

# Order categorical variables
crds.use$Season <- ordered(crds.use$Season, levels = c("Summer", "Winter", "Spring"))
crds.use$Sex <- ordered(crds.use$Sex, levels = c("Female", "Male"))
crds.use$Antibiotics <- ordered(crds.use$Antibiotics, levels = c("No", "Yes"))
crds.use$Substrate <- ordered(crds.use$Substrate, levels = c("Inulin", "Saline"))
crds.use$Diet <- ordered(crds.use$Diet, levels = c("1", "2"))

# Remove outliers
crds.rem <- crds.use[-which(crds.use$ID == "S23"),]
crds.rem <- crds.rem[-which(crds.rem$ID == "S37"),]
crds.rem <- crds.rem[-which(crds.rem$ID == "S60"),]
crds.rem <- crds.rem[-which(crds.rem$ID == "W43"),]
crds.rem <- crds.rem[-which(crds.rem$ID == "W20"),]
  # This is due to odd metagenome
crds.rem <- crds.rem[-which(crds.rem$ID == "W50"),]
crds.rem <- crds.rem[-which(crds.rem$ID == "P20"),]
crds.rem <- crds.rem[-which(crds.rem$ID == "P22"),]

# Separate by substrate
crds.inu <- crds.rem[which(crds.rem$Substrate == "Inulin"),]
crds.sal <- crds.rem[which(crds.rem$Substrate == "Saline"),]

# Separate by substrate + season
crds.inu.s <- crds.inu[which(crds.inu$Season == "Summer"),]
crds.inu.w <- crds.inu[which(crds.inu$Season == "Winter"),]
crds.inu.p <- crds.inu[which(crds.inu$Season == "Spring"),]
crds.sal.s <- crds.sal[which(crds.sal$Season == "Summer"),]
crds.sal.w <- crds.sal[which(crds.sal$Season == "Winter"),]
crds.sal.p <- crds.sal[which(crds.sal$Season == "Spring"),]
```


### Test baseline
```{r}
### Inulin ###

# Summer
res <- resid(lm(Baseline ~ Antibiotics, crds.inu.s))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
var.test(Baseline ~ Antibiotics, crds.inu.s)
  # p = 0.2
  # CI = 0.4359302 24.9670884
t.test(Baseline ~ Antibiotics, crds.inu.s)
  # p = 0.06923
  # CI = -0.1321911  2.8733339

# Winter
res <- resid(lm(Baseline ~ Antibiotics, crds.inu.w))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
var.test(Baseline ~ Antibiotics, crds.inu.w)
  # p = 0.7374
  # CI =  0.129110 4.372901
t.test(Baseline ~ Antibiotics, crds.inu.w)
  # p = 0.695
  # CI = -1.1060369  0.7622274

# Spring
res <- resid(lm(Baseline ~ Antibiotics, crds.inu.p))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
var.test(Baseline ~ Antibiotics, crds.inu.p)
  # p = 0.2246
  # CI = 0.4937591 16.7234051
t.test(Baseline ~ Antibiotics, crds.inu.p)
  # p = 6.8e-05
  # CI = 2.693564 5.445484




### Saline ###

# Summer
res <- resid(lm(Baseline ~ Antibiotics, crds.sal.s))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
var.test(Baseline ~ Antibiotics, crds.sal.s)
  # p = 0.0501
  # CI = 0.9990779 51.0236788
t.test(Baseline ~ Antibiotics, crds.sal.s)
  # p = 0.1954
  # CI = -0.627877  2.507877


# Winter
res <- resid(lm(Baseline ~ Antibiotics, crds.sal.w))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
var.test(Baseline ~ Antibiotics, crds.sal.w)
  # p = 0.02823
  # CI = 1.374395 95.085619
wilcox.test(Baseline ~ Antibiotics, crds.sal.w, conf.int = T)
  # p = 0.7144
  # CI = -0.6099616  0.2999635



# Spring
res <- resid(lm(Baseline ~ Antibiotics, crds.sal.p))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
var.test(Baseline ~ Antibiotics, crds.sal.p)
  # p = 0.784
  # CI = 0.1879005 7.8503783
t.test(Baseline ~ Antibiotics, crds.sal.p)
  # p = 0.2762
  # CI = -1.318519  4.181376




# F test
p.adjust(c(0.2, 0.7374, 0.2246, 0.0501, 0.02823, 0.784), "BH")
  # Inulin Summer = 0.3369
  # Inulin Winter = 0.7840
  # Inulin Spring = 0.3369
  # Saline Summer = 0.1503
  # Saline Winter = 0.1503
  # Saline Spring = 0.7840


# T-test
p.adjust(c(0.06923, 0.695, 6.8e-05, 0.1954, 0.7144, 0.2762), "BH")
  # Inulin Summer = 0.20769
  # Inulin Winter = 0.7144
  # Inulin Spring = 0.000408*
  # Saline Summer = 0.3908
  # Saline Winter = 0.7144
  # Saline Spring = 0.4143
```

### Test AUC_sqrt
```{r}
### Inulin ###

# Summer
res <- resid(lm(AUC_sqrt ~ Antibiotics, crds.inu.s))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
var.test(AUC_sqrt ~ Antibiotics, crds.inu.s)
  # p = 0.0123
  # CI = 2.141923 122.674679
wilcox.test(AUC_sqrt ~ Antibiotics, crds.inu.s, conf.int = T)
  # p = 0.002525
  # CI = 18.59290 40.30118


# Winter
res <- resid(lm(AUC_sqrt ~ Antibiotics, crds.inu.w))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # p = 0.02815
  # Not Normal
fligner.test(AUC_sqrt ~ Antibiotics, crds.inu.w)
  # p = 0.01802
b2 <- two.boot(sample1 = crds.inu.w$AUC_sqrt[which(crds.inu.w$Antibiotics == "No")], 
         sample2 = crds.inu.w$AUC_sqrt[which(crds.inu.w$Antibiotics == "Yes")],
         FUN = var, R = 9999)
boot.ci(b2, conf = 0.95, type = "bca")
  # CI = 36.6, 320.0 
wilcox.test(AUC_sqrt ~ Antibiotics, crds.inu.w, conf.int = T)
  # p = 0.1282
  # CI = -1.113459 29.793857


# Spring
res <- resid(lm(AUC_sqrt ~ Antibiotics, crds.inu.p))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
var.test(AUC_sqrt ~ Antibiotics, crds.inu.p)
  # p = 0.0004868
  # CI = 5.669726 192.031177
wilcox.test(AUC_sqrt ~ Antibiotics, crds.inu.p, conf.int = T)
  # p = 0.001166
  # CI = 17.20083 65.01636





### Saline ###

# Summer
res <- resid(lm(AUC_sqrt ~ Antibiotics, crds.sal.s))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
var.test(AUC_sqrt ~ Antibiotics, crds.sal.s)
  # p = 0.03738
  # CI = 1.149205 58.690779
wilcox.test(AUC_sqrt ~ Antibiotics, crds.sal.s, conf.int = T)
  # p = 0.02597
  # CI = 0.06659934 0.67741637

# Winter
res <- resid(lm(AUC_sqrt ~ Antibiotics, crds.sal.w))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # p = 0.002705
  # Not Normal
fligner.test(AUC_sqrt ~ Antibiotics, crds.sal.w)
  # p = 0.7543
b2 <- two.boot(sample1 = crds.sal.w$AUC_sqrt[which(crds.sal.w$Antibiotics == "No")], 
         sample2 = crds.sal.w$AUC_sqrt[which(crds.sal.w$Antibiotics == "Yes")],
         FUN = var, R = 9999)
boot.ci(b2, conf = 0.95, type = "bca")
  # CI = -0.0274,  0.0510
wilcox.test(AUC_sqrt ~ Antibiotics, crds.sal.w, conf.int = T)
  # p = 0.1775
  # CI = -0.05904796  0.41662474


# Spring
res <- resid(lm(AUC_sqrt ~ Antibiotics, crds.sal.p))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
var.test(AUC_sqrt ~ Antibiotics, crds.sal.p)
  # p = 0.306
  # CI = 0.378423 15.810303
t.test(AUC_sqrt ~ Antibiotics, crds.sal.p)
  # p = 0.09398
  # CI = -0.01902695  0.20580686




# F test
p.adjust(c(0.0123, 0.01802, 0.0004868, 0.03738, 0.7543, 0.306), "BH")
  # Inulin Summer = 0.036040*
  # Inulin Winter = 0.036040*
  # Inulin Spring = 0.0029208*
  # Saline Summer = 0.056070
  # Saline Winter = 0.75430
  # Saline Spring = 0.36720


# T-test
p.adjust(c(0.002525, 0.1282, 0.001166, 0.02597, 0.1775, 0.09398), "BH")
  # Inulin Summer = 0.00757*
  # Inulin Winter = 0.153840
  # Inulin Spring = 0.006996*
  # Saline Summer = 0.051940
  # Saline Winter = 0.17750
  # Saline Spring = 0.140970
```


### Test AvgD
```{r}
### Inulin ###

# Summer
res <- resid(lm(AvgD ~ Antibiotics, crds.inu.s))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
var.test(AvgD ~ Antibiotics, crds.inu.s)
  # p = 0.0004552
  # CI = 11.64781 667.10676
wilcox.test(AvgD ~ Antibiotics, crds.inu.s, conf.int = T)
  # p = 0.002525
  # CI = 345.5849 908.8050


# Winter
res <- resid(lm(AvgD ~ Antibiotics, crds.inu.w))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # p = 0.04713
  # Not Normal
fligner.test(AvgD ~ Antibiotics, crds.inu.w)
  # p = 0.01802
b2 <- two.boot(sample1 = crds.inu.w$AvgD[which(crds.inu.w$Antibiotics == "No")], 
         sample2 = crds.inu.w$AvgD[which(crds.inu.w$Antibiotics == "Yes")],
         FUN = var, R = 9999)
boot.ci(b2, conf = 0.95, type = "bca")
  # CI = 56285, 198632
wilcox.test(AvgD ~ Antibiotics, crds.inu.w, conf.int = T)
  # p = 0.07284
  # CI = -10.89069 663.00111


# Spring
res <- resid(lm(AvgD ~ Antibiotics, crds.inu.p))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
var.test(AvgD ~ Antibiotics, crds.inu.p)
  # p = 4.256e-06
  # CI = 28.52241 966.04159
wilcox.test(AvgD ~ Antibiotics, crds.inu.p, conf.int = T)
  # p = 0.001166
  # CI = 170.5644 1640.5277





### Saline ###

# Summer
res <- resid(lm(AvgD ~ Antibiotics, crds.sal.s))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
var.test(AvgD ~ Antibiotics, crds.sal.s)
  # p = 0.2956
  # CI = 0.3810651 19.4612885
t.test(AvgD ~ Antibiotics, crds.sal.s)
  # p = 0.2423
  # CI = -1.064339  3.655636


# Winter
res <- resid(lm(AvgD ~ Antibiotics, crds.sal.w))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # p = 0.02036
  # Not Normal
fligner.test(AvgD ~ Antibiotics, crds.sal.w)
  # p = 0.7881
b2 <- two.boot(sample1 = crds.sal.w$AvgD[which(crds.sal.w$Antibiotics == "No")], 
         sample2 = crds.sal.w$AvgD[which(crds.sal.w$Antibiotics == "Yes")],
         FUN = var, R = 9999)
boot.ci(b2, conf = 0.95, type = "bca")
  # CI = -0.915,  5.312
wilcox.test(AvgD ~ Antibiotics, crds.sal.w, conf.int = T)
  # p = 0.05195
  # CI = -0.1333333  4.5966667


# Spring
res <- resid(lm(AvgD ~ Antibiotics, crds.sal.p))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
var.test(AvgD ~ Antibiotics, crds.sal.p)
  # p = 0.4012
  # CI = 0.3171385 13.2498695
t.test(AvgD ~ Antibiotics, crds.sal.p)
  # p = 0.3647
  # CI = -0.5826981  1.4546822




# F test
p.adjust(c(0.0004552, 0.01802, 4.256e-06, 0.2956, 0.7881, 0.4012), "BH")
  # Inulin Summer = 0.0013656*
  # Inulin Winter = 0.036040*
  # Inulin Spring = 2.5536e-05*
  # Saline Summer = 0.44340
  # Saline Winter = 0.78810
  # Saline Spring = 0.48144


# T-tests
p.adjust(c(0.002525, 0.07284, 0.001166, 0.2423, 0.05195, 0.3647), "BH")
  # Inulin Summer = 0.007575*
  # Inulin Winter = 0.109260
  # Inulin Spring = 0.006996*
  # Saline Summer = 0.290760
  # Saline Winter = 0.103900
  # Saline Spring = 0.364700

```

### Test MaxD
```{r}
### Inulin ###

# Summer
res <- resid(lm(MaxD ~ Antibiotics, crds.inu.s))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
var.test(MaxD ~ Antibiotics, crds.inu.s)
  # p = 0.0005364
  # CI = 10.72045 613.99370
wilcox.test(MaxD ~ Antibiotics, crds.inu.s, conf.int = T)
  # p = 0.002525
  # CI =  721.1733 2308.7033

# Winter
res <- resid(lm(MaxD ~ Antibiotics, crds.inu.w))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # p = 0.02108
  # Not Normal
fligner.test(MaxD ~ Antibiotics, crds.inu.w)
  # p = 0.01802
b2 <- two.boot(sample1 = crds.inu.w$MaxD[which(crds.inu.w$Antibiotics == "No")], 
         sample2 = crds.inu.w$MaxD[which(crds.inu.w$Antibiotics == "Yes")],
         FUN = var, R = 9999)
boot.ci(b2, conf = 0.95, type = "bca")
  # CI = 95348, 354819 
wilcox.test(MaxD ~ Antibiotics, crds.inu.w, conf.int = T)
  # p = 0.07284
  # CI = -12.9800 968.6667


# Spring
res <- resid(lm(MaxD ~ Antibiotics, crds.inu.p))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Test says normal, but looks sigmoidal/skewed
  # Not Normal
fligner.test(MaxD ~ Antibiotics, crds.inu.p)
  # p = 0.01802
b2 <- two.boot(sample1 = crds.inu.p$MaxD[which(crds.inu.p$Antibiotics == "No")], 
         sample2 = crds.inu.p$MaxD[which(crds.inu.p$Antibiotics == "Yes")],
         FUN = var, R = 9999)
boot.ci(b2, conf = 0.95, type = "bca")
  # 1029213, 3193595
wilcox.test(MaxD ~ Antibiotics, crds.inu.p, conf.int = T)
  # p = 0.0005828
  # CI = 848.480 3456.833




### Saline ###

# Summer
res <- resid(lm(MaxD ~ Antibiotics, crds.sal.s))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
var.test(MaxD ~ Antibiotics, crds.sal.s)
  # p = 0.4592
  # CI = 0.2824644 14.4256760
t.test(MaxD ~ Antibiotics, crds.sal.s, conf.int = T)
  # p = 0.3794
  # CI = -1.487885  3.543627


# Winter
res <- resid(lm(MaxD ~ Antibiotics, crds.sal.w))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # p = 0.02549
  # Test says not normal, but that's just because of 1 outlier
  # Normal
var.test(MaxD ~ Antibiotics, crds.sal.w)
  # p = 0.1229
  # CI = 0.589529 40.785765
t.test(MaxD ~ Antibiotics, crds.sal.w, conf.int = T)
  # p = 0.04888
  # CI = 0.01318182 4.06748485


# Spring
res <- resid(lm(MaxD ~ Antibiotics, crds.sal.p))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
var.test(MaxD ~ Antibiotics, crds.sal.p)
  # p = 0.07471
  # CI = 0.8220952 34.3466793
t.test(MaxD ~ Antibiotics, crds.sal.p)
  # p = 0.2179
  # CI = -0.4924948  1.8617012




# F test
p.adjust(c(0.0005364, 0.01802, 0.01802, 0.4592, 0.1229, 0.07471), "BH")
  # Inulin Summer = 0.0032184*
  # Inulin Winter = 0.036040*
  # Inulin Spring = 0.036040*
  # Saline Summer = 0.45920
  # Saline Winter = 0.14748
  # Saline Spring = 0.1120650


# T-test
p.adjust(c(0.002525, 0.07284, 0.0005828, 0.3794, 0.04888, 0.2179), "BH")
  # Inulin Summer = 0.0075750*
  # Inulin Winter = 0.1092600
  # Inulin Spring = 0.0034968*
  # Saline Summer = 0.3794
  # Saline Winter = 0.09776
  # Saline Spring = 0.26148

```









### Test MaxSlope
```{r}
### Inulin ###

# Summer
res <- resid(lm(MaxSlope ~ Antibiotics, crds.inu.s))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # p = 0.0384
  # Not Normal
fligner.test(MaxSlope ~ Antibiotics, crds.inu.s)
  # p = 0.0361
b2 <- two.boot(sample1 = crds.inu.s$MaxSlope[which(crds.inu.s$Antibiotics == "No")], 
         sample2 = crds.inu.s$MaxSlope[which(crds.inu.s$Antibiotics == "Yes")],
         FUN = var, R = 9999)
boot.ci(b2, conf = 0.95, type = "bca")
  # CI = 210624, 744398
wilcox.test(MaxSlope ~ Antibiotics, crds.inu.s, conf.int = T)
  # p = 0.002525
  # CI = 719.8913 2273.2661


# Winter
res <- resid(lm(MaxSlope ~ Antibiotics, crds.inu.w))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Test says normal, but looks not normal
  # Not Normal
fligner.test(MaxSlope ~ Antibiotics, crds.inu.w)
  # p = 0.01802
b2 <- two.boot(sample1 = crds.inu.w$MaxSlope[which(crds.inu.w$Antibiotics == "No")], 
         sample2 = crds.inu.w$MaxSlope[which(crds.inu.w$Antibiotics == "Yes")],
         FUN = var, R = 9999)
boot.ci(b2, conf = 0.95, type = "bca")
  # 22711, 146727
wilcox.test(MaxSlope ~ Antibiotics, crds.inu.w, conf.int = T)
  # p = 0.006993
  # CI = 59.83307 466.38665


# Spring
res <- resid(lm(MaxSlope ~ Antibiotics, crds.inu.p))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Test says normal, but looks not normal
  # Not Normal
fligner.test(MaxSlope ~ Antibiotics, crds.inu.p)
  # p = 0.01802
b2 <- two.boot(sample1 = crds.inu.p$MaxSlope[which(crds.inu.p$Antibiotics == "No")], 
         sample2 = crds.inu.p$MaxSlope[which(crds.inu.p$Antibiotics == "Yes")],
         FUN = var, R = 9999)
boot.ci(b2, conf = 0.95, type = "bca")
  # 206526, 835401
wilcox.test(MaxSlope ~ Antibiotics, crds.inu.p, conf.int = T)
  # p = 0.0005828
  # CI = 1018.613 2389.035





### Saline ###

# Summer
res <- resid(lm(MaxSlope ~ Antibiotics, crds.sal.s))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Test says not normal, but looks normal tome
  # Normal
var.test(MaxSlope ~ Antibiotics, crds.sal.s)
  # p = 0.05754
  # CI = 0.9339275 47.6964010
t.test(MaxSlope ~ Antibiotics, crds.sal.s, conf.int = T)
  # p = 0.9432
  # CI = -5.039349  5.359592


# Winter
res <- resid(lm(MaxSlope ~ Antibiotics, crds.sal.w))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
var.test(MaxSlope ~ Antibiotics, crds.sal.w)
  # p = 0.3652
  # CI = 0.2836229 19.6220639
t.test(MaxSlope ~ Antibiotics, crds.sal.w, conf.int = T)
  # p = 0.2947
  # CI = -0.9037007  2.6307925


# Spring
res <- resid(lm(MaxSlope ~ Antibiotics, crds.sal.p))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
var.test(MaxSlope ~ Antibiotics, crds.sal.p)
  # p = 0.4164
  # CI = 0.07087668 2.96118828
t.test(MaxSlope ~ Antibiotics, crds.sal.p)
  # p = 0.7952
  # CI = -3.176939  2.506985






# T-test
p.adjust(c(0.002525, 0.002525, 0.0005828, 0.9432, 0.2947, 0.7952), "BH")
  # Inulin Summer = 0.00505*
  # Inulin Winter = 0.00505*
  # Inulin Spring = 0.0034968*
  # Saline Summer = 0.9432
  # Saline Winter = 0.44205
  # Saline Spring = 0.9432


# F test
p.adjust(c(0.0361, 0.01802, 0.01802, 0.05754, 0.3652, 0.4164), "BH")
  # Inulin Summer = 0.0722
  # Inulin Winter = 0.05406
  # Inulin Spring = 0.05406
  # Saline Summer = 0.08631
  # Saline Winter = 0.4164
  # Saline Spring = 0.4164
```


### Test DNA Yield
```{r}
# Load data
dna <- read.csv('dna.csv')
dna.c <- dna[which(grepl("CC", dna$Sample) == T),]

# Remove outliers
dna.c <- dna.c[-which(dna.c$Squirrel == "S23"),]
dna.c <- dna.c[-which(dna.c$Squirrel == "S37"),]
dna.c <- dna.c[-which(dna.c$Squirrel == "S60"),]
dna.c <- dna.c[-which(dna.c$Squirrel == "W43"),]
dna.c <- dna.c[-which(dna.c$Squirrel == "W20"),]
  # This is due to odd metagenome
dna.c <- dna.c[-which(dna.c$Squirrel == "W50"),]
dna.c <- dna.c[-which(dna.c$Squirrel == "P20"),]
  # ABX didn't work

dna.c$Metabolism <- "a"
dna.c$Metabolism[which(dna.c$Season == "Winter")] <- "Hibernation"
dna.c$Metabolism[which(dna.c$Season != "Winter")] <- "Active"
dna.c$Metabolism <- ordered(dna.c$Metabolism, levels = c("Active", "Hibernation"))
dna.c$Season <- ordered(dna.c$Season, levels = c("Summer", "Winter", "Spring"))
dna.s <- dna.c[which(dna.c$Season == "Summer"),]
dna.w <- dna.c[which(dna.c$Season == "Winter"),]
dna.p <- dna.c[which(dna.c$Season == "Spring"),]
dna.inu.s <- dna.s[which(dna.s$Substrate == "Inulin"),]
dna.inu.w <- dna.w[which(dna.w$Substrate == "Inulin"),]
dna.inu.p <- dna.p[which(dna.p$Substrate == "Inulin"),]
dna.sal.s <- dna.s[which(dna.s$Substrate == "Saline"),]
dna.sal.w <- dna.w[which(dna.w$Substrate == "Saline"),]
dna.sal.p <- dna.p[which(dna.p$Substrate == "Saline"),]



### Inulin

# Summer
res <- resid(lm(DNA_Yield_.ng.mg. ~ Antibiotics, dna.inu.s))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # p = 0.03381
  # Not Normal
fligner.test(DNA_Yield_.ng.mg. ~ Antibiotics, dna.inu.s)
  # p = 0.02065
b2 <- two.boot(sample1 = dna.inu.s$DNA_Yield_.ng.mg.[which(dna.inu.s$Antibiotics == "No Antibiotics")], sample2 = dna.inu.s$DNA_Yield_.ng.mg.[which(dna.inu.s$Antibiotics == "Antibiotics")], FUN = var, R = 9999)
boot.ci(b2, conf = 0.95, type = "bca")
  # CI = 16, 2516
wilcox.test(DNA_Yield_.ng.mg. ~ Antibiotics, dna.inu.s, conf.int = T)
  # p = 0.00306
  # CI = -150.61880  -47.70191

# Winter
res <- resid(lm(DNA_Yield_.ng.mg. ~ Antibiotics, dna.inu.w))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # p = 0.03043
  # Not Normal
fligner.test(DNA_Yield_.ng.mg. ~ Antibiotics, dna.inu.w)
  # p = 0.003619
b2 <- two.boot(sample1 = dna.inu.w$DNA_Yield_.ng.mg.[which(dna.inu.w$Antibiotics == "No Antibiotics")], sample2 = dna.inu.w$DNA_Yield_.ng.mg.[which(dna.inu.w$Antibiotics == "Antibiotics")], FUN = var, R = 9999)
boot.ci(b2, conf = 0.95, type = "bca")
  # CI = 445, 2681
wilcox.test(DNA_Yield_.ng.mg. ~ Antibiotics, dna.inu.w, conf.int = T)
  # p = 0.001166
  # CI = -172.66179  -77.09414

# Spring
res <- resid(lm(DNA_Yield_.ng.mg. ~ Antibiotics, dna.inu.p))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Test says normal, but I disagree. Looks sigmoidal like the others
  # Not Normal
fligner.test(DNA_Yield_.ng.mg. ~ Antibiotics, dna.inu.p)
  # p = 0.002404
b2 <- two.boot(sample1 = dna.inu.p$DNA_Yield_.ng.mg.[which(dna.inu.p$Antibiotics == "No Antibiotics")], sample2 = dna.inu.p$DNA_Yield_.ng.mg.[which(dna.inu.p$Antibiotics == "Antibiotics")], FUN = var, R = 9999)
boot.ci(b2, conf = 0.95, type = "bca")
  # CI = 1458, 4805
wilcox.test(DNA_Yield_.ng.mg. ~ Antibiotics, dna.inu.p, conf.int = T)
  # p = 0.0003108
  # CI = -204.0673  -80.9147




### Saline

# Summer
res <- resid(lm(DNA_Yield_.ng.mg. ~ Antibiotics, dna.sal.s))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # p = 0.01227
  # Not Normal
fligner.test(DNA_Yield_.ng.mg. ~ Antibiotics, dna.sal.s)
  # p = 0.01166
b2 <- two.boot(sample1 = dna.sal.s$DNA_Yield_.ng.mg.[which(dna.sal.s$Antibiotics == "No Antibiotics")], sample2 = dna.sal.s$DNA_Yield_.ng.mg.[which(dna.sal.s$Antibiotics == "Antibiotics")], FUN = var, R = 9999)
boot.ci(b2, conf = 0.95, type = "bca")
  # CI = 553, 4279
wilcox.test(DNA_Yield_.ng.mg. ~ Antibiotics, dna.sal.s, conf.int = T)
  # p = 0.00193
  # CI = -114.06257  -65.46469

# Winter
res <- resid(lm(DNA_Yield_.ng.mg. ~ Antibiotics, dna.sal.w))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Test says normal, but I disagree. Looks sigmoidal like the others
  # Not Normal
fligner.test(DNA_Yield_.ng.mg. ~ Antibiotics, dna.sal.w)
  # p = 0.06372
b2 <- two.boot(sample1 = dna.sal.w$DNA_Yield_.ng.mg.[which(dna.sal.w$Antibiotics == "No Antibiotics")], sample2 = dna.sal.w$DNA_Yield_.ng.mg.[which(dna.sal.w$Antibiotics == "Antibiotics")], FUN = var, R = 9999)
boot.ci(b2, conf = 0.95, type = "bca")
  # CI = 364.7, 1662.1
wilcox.test(DNA_Yield_.ng.mg. ~ Antibiotics, dna.sal.w, conf.int = T)
  # p = 0.0005828
  # CI = -112.78001  -63.19306

# Spring
res <- resid(lm(DNA_Yield_.ng.mg. ~ Antibiotics, dna.sal.p))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Test says normal, but I disagree. Looks sigmoidal like the others
  # Not Normal
fligner.test(DNA_Yield_.ng.mg. ~ Antibiotics, dna.sal.p)
  # p = 0.08886
b2 <- two.boot(sample1 = dna.sal.p$DNA_Yield_.ng.mg.[which(dna.sal.p$Antibiotics == "No Antibiotics")], sample2 = dna.sal.p$DNA_Yield_.ng.mg.[which(dna.sal.p$Antibiotics == "Antibiotics")], FUN = var, R = 9999)
boot.ci(b2, conf = 0.95, type = "bca")
  # CI = -1999.7,  2315.4
wilcox.test(DNA_Yield_.ng.mg. ~ Antibiotics, dna.sal.p, conf.int = T)
  # p = 0.002331
  # CI = -167.92572  -78.14441




# Fligner tests
p.adjust(c(0.00306, 0.003619, 0.002404, 0.01166, 0.06372, 0.08886), "BH")
  # Inulin Summer = 0.007238*
  # Inulin Winter = 0.007238*
  # Inulin Spring = 0.007238*
  # Saline Summer = 0.017490*
  # Saline Winter = 0.076464
  # Saline Spring = 0.088860


# Wilcoxon tests
p.adjust(c(0.02065, 0.001166, 0.0003108, 0.00193, 0.0005828, 0.002331), "BH")
  # Inulin Summer = 0.0206500*
  # Inulin Winter = 0.0023320*
  # Inulin Spring = 0.0017484*
  # Saline Summer = 0.0027972*
  # Saline Winter = 0.0017484*
  # Saline Spring = 0.0027972*

```



### Plot errything
```{r}
### Prepare data for plotting
# DNA yield
dna.c$SeasonABX <- interaction(dna.c$Season, dna.c$Antibiotics)
dna.c$SeasonABX <- ordered(dna.c$SeasonABX, levels=c("Summer.No Antibiotics", "Summer.Antibiotics", "Winter.No Antibiotics", "Winter.Antibiotics", "Spring.No Antibiotics", "Spring.Antibiotics"))

# Inulin
crds.inu$SeasonABX <- interaction(crds.inu$Season, crds.inu$Antibiotics)
crds.inu$SeasonABX <- ordered(crds.inu$SeasonABX, levels=c("Summer.No", "Summer.Yes", "Winter.No", "Winter.Yes", "Spring.No", "Spring.Yes"))

# Saline
crds.sal$SeasonABX <- interaction(crds.sal$Season, crds.sal$Antibiotics)
crds.sal$SeasonABX <- ordered(crds.sal$SeasonABX, levels=c("Summer.No", "Summer.Yes", "Winter.No", "Winter.Yes", "Spring.No", "Spring.Yes"))


  
### DNA yield
abx.dna <- ggplot(dna.c, aes(x = Season, y = X.DNA._.ng.uL., color = SeasonABX, fill = SeasonABX)) +
  geom_dotplot(binaxis = 'y', stackdir = 'center', dotsize = 1.5,
               position = position_dodge(0.7), stackratio = 0.5) +
  scale_color_manual(values = c("#c98b00", "#E69F00", "#004166", "#006299", "#00966d",
                                "#00bf8b")) +
  scale_fill_manual(values = c("#E69F00", "white", "#006299", "white", "#00bf8b",
                               "white")) +
  stat_summary(fun.data = "mean_cl_normal", fun.args = list(mult = 1), geom = "pointrange",
               color = "black", position = position_dodge(0.7), size = 0.5) +
  ggtitle("DNA yield")  + 
  ylab("DNA yield (ng/uL)") +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.background = element_blank(),
        axis.title.x = element_text(face="bold", size=10, margin = margin(t = 7.5)),
        axis.title.y = element_text(face="bold", size=10),
        axis.text.x = element_text(size=10),
        axis.text.y = element_text(size=10),
        plot.title = element_text(hjust = 0.5, size = 12, face = "bold"),
        legend.position = "none")




# Inulin AUC
abx.inu.auc.plot <- ggplot(crds.inu, aes(x = Season, y = AUC_sqrt, color = SeasonABX,
                                    fill = SeasonABX)) +
  geom_dotplot(binaxis = 'y', stackdir = 'center', dotsize = 1.5,
               position = position_dodge(0.7), stackratio = 0.5) +
  scale_color_manual(values = c("#c98b00", "#E69F00", "#004166", "#006299", "#00966d",
                                "#00bf8b")) +
  scale_fill_manual(values = c("#E69F00", "white", "#006299", "white", "#00bf8b",
                               "white")) +
  stat_summary(fun.data = "mean_cl_normal", fun.args = list(mult = 1), geom = "pointrange",
               color = "black", position = position_dodge(0.7), size = 0.5) +
  ggtitle("Inulin")  + 
  ylab(expression("AUC"~~delta^13~"C"~"(%"[o]~")")) +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.background = element_blank(),
        axis.title.x = element_text(face="bold", size=10, margin = margin(t = 7.5)),
        axis.title.y = element_text(face="bold", size=10),
        axis.text.x = element_text(size=10),
        axis.text.y = element_text(size=10),
        plot.title = element_text(hjust = 0.5, size = 12, face = "bold"),
        legend.position = "none")



# Saline
sal.AUC.plot <- ggplot(crds.sal, aes(x = Season, y = AUC_sqrt, color = SeasonABX,
                                    fill = SeasonABX)) +
  geom_dotplot(binaxis = 'y', stackdir = 'center', dotsize = 1.5,
               position = position_dodge(0.7), stackratio = 0.5) +
  scale_color_manual(values = c("#c98b00", "#E69F00", "#004166", "#006299", "#00966d",
                                "#00bf8b")) +
  scale_fill_manual(values = c("#E69F00", "white", "#006299", "white", "#00bf8b",
                               "white")) +
  stat_summary(fun.data = "mean_cl_normal", fun.args = list(mult = 1), geom = "pointrange",
               color = "black", position = position_dodge(0.7), size = 0.5) +
  ggtitle("Saline")  + 
  ylab(expression("AUC"~~delta^13~"C"~"(%"[o]~")")) +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.background = element_blank(),
        axis.title.x = element_text(face="bold", size=10, margin = margin(t = 7.5)),
        axis.title.y = element_text(face="bold", size=10),
        axis.text.x = element_text(size=10),
        axis.text.y = element_text(size=10),
        plot.title = element_text(hjust = 0.5, size = 12, face = "bold"),
        legend.position = "none")
```




### Hib Dates
```{r}
### Load data ###

# Dates
dates <- read.csv('metadata_dates.csv')
dates_use <- dates[-which(dates$Season == "Summer"),]
rownames(dates_use) <- 1:nrow(dates_use)
dates_use <- dates_use[-13:-28,]
rownames(dates_use) <- 1:nrow(dates_use)
dates_use <- dates_use[-33:-40,]

# Remove outliers
dates_use <- dates_use[-which(dates_use$ID == "W20"),]



# Add CRDS metrics
for(k in 1:nrow(dates_use)){
  ID <- dates_use$ID[k]
  rowUse <- which(crds.rem$ID == ID)
  dates_use$AvgD[k] <- crds.rem$AvgD[rowUse]
  dates_use$MaxD[k] <- crds.rem$MaxD[rowUse]
  dates_use$MaxSlope[k] <- crds.rem$MaxSlope[rowUse]
  dates_use$AUC_sqrt[k] <- crds.rem$AUC_sqrt[rowUse]
  dates_use$Baseline[k] <- crds.rem$Baseline[rowUse]
}
  
# Separate by Season
dates.spr <- dates_use[which(dates_use$Season == "Spring"),]
dates.win <- dates_use[which(dates_use$Season == "Winter"),]



### Spring
res <- resid(lm(Days_Hib ~ Antibiotics, dates.spr))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
var.test(Days_Hib ~ Antibiotics, dates.spr)
  # p-value = 0.9201
t.test(Days_Hib ~ Antibiotics, dates.spr)
  # p = 0.1215


res <- resid(lm(IBA.Hib ~ Antibiotics, dates.spr))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
var.test(IBA.Hib ~ Antibiotics, dates.spr)
  # p-value = 0.9449
t.test(IBA.Hib ~ Antibiotics, dates.spr)
  # p = 0.9588


res <- resid(lm(Num_IBA ~ Antibiotics, dates.spr))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
var.test(Num_IBA ~ Antibiotics, dates.spr)
  # p-value = 0.5191
t.test(Num_IBA ~ Antibiotics, dates.spr)
  # p = 0.4637



### Winter
res <- resid(lm(Days_Hib ~ Antibiotics, dates.win))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
var.test(Days_Hib ~ Antibiotics, dates.win)
  # p-value = 0.1999
t.test(Days_Hib ~ Antibiotics, dates.win)
  # p = 0.01295


res <- resid(lm(IBA.Hib ~ Antibiotics, dates.win))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
var.test(IBA.Hib ~ Antibiotics, dates.win)
  # p-value = 0.3048
t.test(IBA.Hib ~ Antibiotics, dates.win)
  # p = 0.4024


res <- resid(lm(Num_IBA ~ Antibiotics, dates.win))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
var.test(Num_IBA ~ Antibiotics, dates.win)
  # p-value = 0.8388
t.test(Num_IBA ~ Antibiotics, dates.win)
  # p = 0.469

```
