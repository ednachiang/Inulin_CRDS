---
title: "Code_TestABX"
author: "Edna Chiang"
date: "12/14/2021"
output: html_document
---
### Load Packages, scripts, and functions
```{r}
library(ggplot2)
library(plyr)
library(dplyr)
library(grid)
library(MESS)
library(pgirmess)
library(Bolstad2)
library(phyloseq)
library(psych)
library(car)
source('scripts/misc.R')
set.seed(1)
theme_set(theme_bw())
```

### Load Data
```{r}
load('crds.norm.RData')
load('crds.use.Rdata')
meta <- read.csv('metadata.csv')
```

### Prepare CRDS data
```{r}
# Add metadata
crds.use[, colnames(meta)[3:ncol(meta)]] <- NA
for(i in 1:nrow(crds.use)){
  meta.row <- which(meta$ID == crds.use$ID[i])
  crds.use[i, 7:ncol(crds.use)] <- meta[meta.row, 3:ncol(meta)]
}

# Calculate square root of AUC
crds.use$AUC <- as.numeric(crds.use$AUC)
minAUC <- min(crds.use$AUC)
crds.use$AUC_sqrt <- crds.use$AUC + (minAUC * -1)
crds.use$AUC_sqrt <- sqrt(crds.use$AUC_sqrt)

# Convert to numeric
crds.use$AvgDelta <- as.numeric(crds.use$AvgDelta)
crds.use$MaxD <- as.numeric(crds.use$MaxD)
crds.use$MaxSlope <- as.numeric(crds.use$MaxSlope)
crds.use$AUC <- as.numeric(crds.use$AUC)
crds.use$MaxD <- as.numeric(crds.use$MaxD)
crds.use$Baseline <- as.numeric(crds.use$Baseline)

# Order categorical variables
crds.use$Season <- ordered(crds.use$Season, levels = c("Summer", "Winter", "Spring"))
crds.use$Sex <- ordered(crds.use$Sex, levels = c("Female", "Male"))
crds.use$Antibiotics <- ordered(crds.use$Antibiotics, levels = c("No", "Yes"))
crds.use$Substrate <- ordered(crds.use$Substrate, levels = c("Inulin", "Saline"))
crds.use$Diet <- ordered(crds.use$Diet, levels = c("1", "2"))

# Remove outliers
crds.rem <- crds.use[-which(crds.use$ID == "S23"),]
crds.rem <- crds.rem[-which(crds.rem$ID == "S37"),]
crds.rem <- crds.rem[-which(crds.rem$ID == "S60"),]
crds.rem <- crds.rem[-which(crds.rem$ID == "W43"),]
crds.rem <- crds.rem[-which(crds.rem$ID == "W20"),]
  # This is due to odd metagenome
crds.rem <- crds.rem[-which(crds.rem$ID == "W50"),]

# Separate by substrate
crds.inu <- crds.rem[which(crds.rem$Substrate == "Inulin"),]
crds.sal <- crds.rem[which(crds.rem$Substrate == "Saline"),]

# Separate by substrate + season
crds.inu.s <- crds.inu[which(crds.inu$Season == "Summer"),]
crds.inu.w <- crds.inu[which(crds.inu$Season == "Winter"),]
crds.inu.p <- crds.inu[which(crds.inu$Season == "Spring"),]
crds.sal.s <- crds.sal[which(crds.sal$Season == "Summer"),]
crds.sal.w <- crds.sal[which(crds.sal$Season == "Winter"),]
crds.sal.p <- crds.sal[which(crds.sal$Season == "Spring"),]
```


### Test baseline
```{r}
### Inulin ###

# Summer
res <- resid(lm(Baseline ~ Antibiotics, crds.inu.s))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
var.test(Baseline ~ Antibiotics, crds.inu.s)
  # p = 0.2
t.test(Baseline ~ Antibiotics, crds.inu.s)
  # p = 0.06923


# Winter
res <- resid(lm(Baseline ~ Antibiotics, crds.inu.w))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
var.test(Baseline ~ Antibiotics, crds.inu.w)
  # p = 0.7374
t.test(Baseline ~ Antibiotics, crds.inu.w)
  # p = 0.695

# Spring
res <- resid(lm(Baseline ~ Antibiotics, crds.inu.p))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
var.test(Baseline ~ Antibiotics, crds.inu.p)
  # p = 0.2246
t.test(Baseline ~ Antibiotics, crds.inu.p)
  # p = 6.8e-05




### Saline ###

# Summer
res <- resid(lm(Baseline ~ Antibiotics, crds.sal.s))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
var.test(Baseline ~ Antibiotics, crds.sal.s)
  # p = 0.0501
t.test(Baseline ~ Antibiotics, crds.sal.s)
  # p = 0.1954


# Winter
res <- resid(lm(Baseline ~ Antibiotics, crds.sal.w))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
var.test(Baseline ~ Antibiotics, crds.sal.w)
  # p = 0.02823
wilcox.test(Baseline ~ Antibiotics, crds.sal.w)
  # p = 0.7144


# Spring
res <- resid(lm(Baseline ~ Antibiotics, crds.sal.p))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
var.test(Baseline ~ Antibiotics, crds.sal.p)
  # p = 0.784
t.test(Baseline ~ Antibiotics, crds.sal.p)
  # p = 0.2762


# T-test
p.adjust(c(0.06923, 0.695, 6.8e-05, 0.1954, 0.7144, 0.2762), "BH")
  # Inulin Summer = 0.20769
  # Inulin Winter = 0.7144
  # Inulin Spring = 0.000408*
  # Saline Summer = 0.3908
  # Saline Winter = 0.7144
  # Saline Spring = 0.4143

# F test
p.adjust(c(0.2, 0.7374, 0.2246, 0.0501, 0.02823, 0.784), "BH")
  # Inulin Summer = 0.3369
  # Inulin Winter = 0.7840
  # Inulin Spring = 0.3369
  # Saline Summer = 0.1503
  # Saline Winter = 0.1503
  # Saline Spring = 0.7840

```

### Test AUC_sqrt
```{r}
### Inulin ###

# Summer
res <- resid(lm(AUC_sqrt ~ Antibiotics, crds.inu.s))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
var.test(AUC_sqrt ~ Antibiotics, crds.inu.s)
  # p = 0.01174
wilcox.test(AUC_sqrt ~ Antibiotics, crds.inu.s)
  # p = 0.002525


# Winter
res <- resid(lm(AUC_sqrt ~ Antibiotics, crds.inu.w))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # p = 0.02794
  # Not Normal
fligner.test(AUC_sqrt ~ Antibiotics, crds.inu.w)
  # p = 0.01802
wilcox.test(AUC_sqrt ~ Antibiotics, crds.inu.w)
  # p = 0.1282


# Spring
res <- resid(lm(AUC_sqrt ~ Antibiotics, crds.inu.p))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
var.test(AUC_sqrt ~ Antibiotics, crds.inu.p)
  # p = 0.0004868
wilcox.test(AUC_sqrt ~ Antibiotics, crds.inu.p)
  # p = 0.001166





### Saline ###

# Summer
res <- resid(lm(AUC_sqrt ~ Antibiotics, crds.sal.s))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
var.test(AUC_sqrt ~ Antibiotics, crds.sal.s)
  # p = 0.03738
wilcox.test(AUC_sqrt ~ Antibiotics, crds.sal.s)
  # p = 0.02597

# Winter
res <- resid(lm(AUC_sqrt ~ Antibiotics, crds.sal.w))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # p = 0.002705
  # Not Normal
fligner.test(AUC_sqrt ~ Antibiotics, crds.sal.w)
  # p = 0.7543
wilcox.test(AUC_sqrt ~ Antibiotics, crds.sal.w)
  # p = 0.01732


# Spring
res <- resid(lm(AUC_sqrt ~ Antibiotics, crds.sal.p))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
var.test(AUC_sqrt ~ Antibiotics, crds.sal.p)
  # p = 0.1693
t.test(AUC_sqrt ~ Antibiotics, crds.sal.p)
  # p = 0.7424


# T-test
p.adjust(c(0.002525, 0.1282, 0.001166, 0.02597, 0.01732, 0.7424), "BH")
  # Inulin Summer = 0.007575*
  # Inulin Winter = 0.15384
  # Inulin Spring = 0.006996*
  # Saline Summer = 0.038955*
  # Saline Winter = 0.03464*
  # Saline Spring = 0.7424

# F test
p.adjust(c(0.01174, 0.01802, 0.0004868, 0.03738, 0.7543, 0.1693), "BH")
  # Inulin Summer = 0.03522*
  # Inulin Winter = 0.03604*
  # Inulin Spring = 0.0029208*
  # Saline Summer = 0.05607
  # Saline Winter = 0.75430
  # Saline Spring = 0.20316

```


### Test AvgDelta
```{r}
### Inulin ###

# Summer
res <- resid(lm(AvgDelta ~ Antibiotics, crds.inu.s))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
var.test(AvgDelta ~ Antibiotics, crds.inu.s)
  # p = 0.0007286
wilcox.test(AvgDelta ~ Antibiotics, crds.inu.s)
  # p = 0.002525


# Winter
res <- resid(lm(AvgDelta ~ Antibiotics, crds.inu.w))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # p = 0.0422
  # Not Normal
fligner.test(AvgDelta ~ Antibiotics, crds.inu.w)
  # p = 0.01802
wilcox.test(AvgDelta ~ Antibiotics, crds.inu.w)
  # p = 0.07284


# Spring
res <- resid(lm(AvgDelta ~ Antibiotics, crds.inu.p))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
var.test(AvgDelta ~ Antibiotics, crds.inu.p)
  # p = 3.869e-06
wilcox.test(AvgDelta ~ Antibiotics, crds.inu.p)
  # p = 0.001166





### Saline ###

# Summer
res <- resid(lm(AvgDelta ~ Antibiotics, crds.sal.s))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
var.test(AvgDelta ~ Antibiotics, crds.sal.s)
  # p = 0.0008584
wilcox.test(AvgDelta ~ Antibiotics, crds.sal.s)
  # p = 0.02597


# Winter
res <- resid(lm(AvgDelta ~ Antibiotics, crds.sal.w))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # p = 0.0002892
  # Not Normal
fligner.test(AvgDelta ~ Antibiotics, crds.sal.w)
  # p = 0.4757
wilcox.test(AvgDelta ~ Antibiotics, crds.sal.w)
  # p = 0.01762


# Spring
res <- resid(lm(AvgDelta ~ Antibiotics, crds.sal.p))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
var.test(AvgDelta ~ Antibiotics, crds.sal.p)
  # p = 0.08643
t.test(AvgDelta ~ Antibiotics, crds.sal.p)
  # p = 0.7463


# ANOVA
p.adjust(c(0.002525, 0.07284, 0.001166, 0.02597, 0.01762, 0.7463), "BH")
  # Inulin Summer = 0.007575*
  # Inulin Winter = 0.087408
  # Inulin Spring = 0.006996*
  # Saline Summer = 0.038955
  # Saline Winter = 0.03524*
  # Saline Spring = 0.7463

# F test
p.adjust(c(0.0007286, 0.01802, 3.869e-06, 0.0008584, 0.4757, 0.08643), "BH")
  # Inulin Summer = 0.0017168*
  # Inulin Winter = 0.02703*
  # Inulin Spring = 0.000023214*
  # Saline Summer = 0.0017168*
  # Saline Winter = 0.4757
  # Saline Spring = 0.103716

```

### Test MaxD
```{r}
### Inulin ###

# Summer
res <- resid(lm(MaxD ~ Antibiotics, crds.inu.s))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
var.test(MaxD ~ Antibiotics, crds.inu.s)
  # p = 0.0004015
wilcox.test(MaxD ~ Antibiotics, crds.inu.s)
  # p = 0.002525

# Winter
res <- resid(lm(MaxD ~ Antibiotics, crds.inu.w))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # p = 0.02794
  # Not Normal
fligner.test(MaxD ~ Antibiotics, crds.inu.w)
  # p = 0.01802
wilcox.test(MaxD ~ Antibiotics, crds.inu.w)
  # p = 0.07284


# Spring
res <- resid(lm(MaxD ~ Antibiotics, crds.inu.p))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
var.test(MaxD ~ Antibiotics, crds.inu.p)
  # p = 2.431e-06
wilcox.test(MaxD ~ Antibiotics, crds.inu.p)
  # p = 0.0005828




### Saline ###

# Summer
res <- resid(lm(MaxD ~ Antibiotics, crds.sal.s))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
var.test(MaxD ~ Antibiotics, crds.sal.s)
  # p = 0.0003736
wilcox.test(MaxD ~ Antibiotics, crds.sal.s)
  # p = 0.04113


# Winter
res <- resid(lm(MaxD ~ Antibiotics, crds.sal.w))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # p = 8.816e-05
  # Not Normal
fligner.test(MaxD ~ Antibiotics, crds.sal.w)
  # p = 0.2565
wilcox.test(MaxD ~ Antibiotics, crds.sal.w)
  # p = 0.0303


# Spring
res <- resid(lm(MaxD ~ Antibiotics, crds.sal.p))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
var.test(MaxD ~ Antibiotics, crds.sal.p)
  # p = 0.2943
t.test(MaxD ~ Antibiotics, crds.sal.p)
  # p = 0.9345


# T-test
p.adjust(c(0.002525, 0.07284, 0.0005828, 0.04113, 0.0303, 0.9345), "BH")
  # Inulin Summer = 0.007575*
  # Inulin Winter = 0.087408
  # Inulin Spring = 0.0034968*
  # Saline Summer = 0.0616950
  # Saline Winter = 0.0606
  # Saline Spring = 0.9345

# F test
p.adjust(c(0.0004015, 0.01802, 2.431e-06, 0.0003736, 0.2565, 0.2943), "BH")
  # Inulin Summer = 0.000803*
  # Inulin Winter = 0.02703*
  # Inulin Spring = 0.000014586*
  # Saline Summer = 0.000803*
  # Saline Winter = 0.2943
  # Saline Spring = 0.2943

```









### Test MaxSlope
```{r}
### Inulin ###

# Summer
res <- resid(lm(MaxSlope ~ Antibiotics, crds.inu.s))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # p = 0.04677
  # Not Normal
fligner.test(MaxSlope ~ Antibiotics, crds.inu.s)
  # p = 0.0361
wilcox.test(MaxSlope ~ Antibiotics, crds.inu.s)
  # p = 0.002525


# Winter
res <- resid(lm(MaxSlope ~ Antibiotics, crds.inu.w))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
var.test(MaxSlope ~ Antibiotics, crds.inu.w)
  # p = 9.487e-06
wilcox.test(MaxSlope ~ Antibiotics, crds.inu.w)
  # p = 0.006993


# Spring
res <- resid(lm(MaxSlope ~ Antibiotics, crds.inu.p))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
var.test(MaxSlope ~ Antibiotics, crds.inu.p)
  # p = 2.543e-06
wilcox.test(MaxSlope ~ Antibiotics, crds.inu.p)
  # p = 0.0005828





### Saline ###

# Summer
res <- resid(lm(MaxSlope ~ Antibiotics, crds.sal.s))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # p = 0.005105
  # Not Normal
fligner.test(MaxSlope ~ Antibiotics, crds.sal.s)
  # p = 0.2658
wilcox.test(MaxSlope ~ Antibiotics, crds.sal.s)
  # p = 0.6991


# Winter
res <- resid(lm(MaxSlope ~ Antibiotics, crds.sal.w))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # p = 0.0002066
  # Not Normal
fligner.test(MaxSlope ~ Antibiotics, crds.sal.w)
  # p = 0.3803
wilcox.test(MaxSlope ~ Antibiotics, crds.sal.w)
  # p = 0.5368


# Spring
res <- resid(lm(MaxSlope ~ Antibiotics, crds.sal.p))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
var.test(MaxSlope ~ Antibiotics, crds.sal.p)
  # p = 0.5717
t.test(MaxSlope ~ Antibiotics, crds.sal.p)
  # p = 0.7398


# T-test
p.adjust(c(0.002525, 0.006993, 0.0005828, 0.6991, 0.5368, 0.7398), "BH")
  # Inulin Summer = 0.007575*
  # Inulin Winter = 0.013986*
  # Inulin Spring = 0.0034968*
  # Saline Summer = 0.7398
  # Saline Winter = 0.7398
  # Saline Spring = 0.7398

# F test
p.adjust(c(0.0361, 9.487e-06, 2.543e-06, 0.2658, 0.3803, 0.5717), "BH")
  # Inulin Summer = 0.072200
  # Inulin Winter = 2.8461e-05*
  # Inulin Spring = 1.5258e-05*
  # Saline Summer = 0.3987*
  # Saline Winter = 0.45636
  # Saline Spring = 0.5717

```


### Test DNA Yield
```{r}
# Load data
dna <- read.csv('dna.csv')
dna.c <- dna[which(grepl("CC", dna$Sample) == T),]
dna.c$Metabolism <- "a"
dna.c$Metabolism[which(dna.c$Season == "Winter")] <- "Hibernation"
dna.c$Metabolism[which(dna.c$Season != "Winter")] <- "Active"
dna.c$Metabolism <- ordered(dna.c$Metabolism, levels = c("Active", "Hibernation"))
dna.c$Season <- ordered(dna.c$Season, levels = c("Summer", "Winter", "Spring"))
dna.s <- dna.c[which(dna.c$Season == "Summer"),]
dna.w <- dna.c[which(dna.c$Season == "Winter"),]
dna.p <- dna.c[which(dna.c$Season == "Spring"),]
dna.inu.s <- dna.s[which(dna.s$Substrate == "Inulin"),]
dna.inu.w <- dna.w[which(dna.w$Substrate == "Inulin"),]
dna.inu.p <- dna.p[which(dna.p$Substrate == "Inulin"),]
dna.sal.s <- dna.s[which(dna.s$Substrate == "Saline"),]
dna.sal.w <- dna.w[which(dna.w$Substrate == "Saline"),]
dna.sal.p <- dna.p[which(dna.p$Substrate == "Saline"),]


# All
res <- resid(lm(DNA_Yield_.ng.mg. ~ Antibiotics, dna.c))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # p = 1.213e-06
  # Not Normal
fligner.test(DNA_Yield_.ng.mg. ~ Antibiotics, dna.c)
  # p = 3.367e-08
wilcox.test(DNA_Yield_.ng.mg. ~ Antibiotics, dna.c)
  # p = 1.266e-14


# Summer
res <- resid(lm(DNA_Yield_.ng.mg. ~ Antibiotics, dna.s))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # p = 0.005902
  # Not Normal
fligner.test(DNA_Yield_.ng.mg. ~ Antibiotics, dna.s)
  # p = 0.0007326
wilcox.test(DNA_Yield_.ng.mg. ~ Antibiotics, dna.s)
  # p = 8.169e-06


# Winter
res <- resid(lm(DNA_Yield_.ng.mg. ~ Antibiotics, dna.w))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # p = 0.002462
  # Not Normal
fligner.test(DNA_Yield_.ng.mg. ~ Antibiotics, dna.w)
  # p = 0.0002154
wilcox.test(DNA_Yield_.ng.mg. ~ Antibiotics, dna.w)
  # p = 9.971e-08


# Spring
res <- resid(lm(DNA_Yield_.ng.mg. ~ Antibiotics, dna.p))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # p = 0.03449
  # Not Normal
fligner.test(DNA_Yield_.ng.mg. ~ Antibiotics, dna.p)
  # p = 0.002388
wilcox.test(DNA_Yield_.ng.mg. ~ Antibiotics, dna.p)
  # p = 3.49e-07



### Inulin

# Summer
res <- resid(lm(DNA_Yield_.ng.mg. ~ Antibiotics, dna.inu.s))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # p = 0.03381
  # Not Normal
fligner.test(DNA_Yield_.ng.mg. ~ Antibiotics, dna.inu.s)
  # p = 0.02065
wilcox.test(DNA_Yield_.ng.mg. ~ Antibiotics, dna.inu.s)
  # p = 0.00306

# Winter
res <- resid(lm(DNA_Yield_.ng.mg. ~ Antibiotics, dna.inu.w))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # p = 0.03043
  # Not Normal
fligner.test(DNA_Yield_.ng.mg. ~ Antibiotics, dna.inu.w)
  # p = 0.003619
wilcox.test(DNA_Yield_.ng.mg. ~ Antibiotics, dna.inu.w)
  # p = 0.001166

# Spring
res <- resid(lm(DNA_Yield_.ng.mg. ~ Antibiotics, dna.inu.p))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Test says normal, but I disagree. Looks sigmoidal like the others
  # Not Normal
fligner.test(DNA_Yield_.ng.mg. ~ Antibiotics, dna.inu.p)
  # p = 0.002404
wilcox.test(DNA_Yield_.ng.mg. ~ Antibiotics, dna.inu.p)
  # p = 0.0003108




### Inulin

# Summer
res <- resid(lm(DNA_Yield_.ng.mg. ~ Antibiotics, dna.sal.s))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # p = 0.01227
  # Not Normal
fligner.test(DNA_Yield_.ng.mg. ~ Antibiotics, dna.sal.s)
  # p = 0.01166
wilcox.test(DNA_Yield_.ng.mg. ~ Antibiotics, dna.sal.s)
  # p = 0.00193

# Winter
res <- resid(lm(DNA_Yield_.ng.mg. ~ Antibiotics, dna.sal.w))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Test says normal, but I disagree. Looks sigmoidal like the others
  # Not Normal
fligner.test(DNA_Yield_.ng.mg. ~ Antibiotics, dna.sal.w)
  # p = 0.06372
wilcox.test(DNA_Yield_.ng.mg. ~ Antibiotics, dna.sal.w)
  # p = 0.0005828

# Spring
res <- resid(lm(DNA_Yield_.ng.mg. ~ Antibiotics, dna.sal.p))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Test says normal, but I disagree. Looks sigmoidal like the others
  # Not Normal
fligner.test(DNA_Yield_.ng.mg. ~ Antibiotics, dna.sal.p)
  # p = 0.08886
wilcox.test(DNA_Yield_.ng.mg. ~ Antibiotics, dna.sal.p)
  # p = 0.002331
```



### Hib Dates
```{r}
### Load data ###

# Dates
dates <- read.csv('metadata_dates.csv')
dates_use <- dates[-which(dates$Season == "Summer"),]
rownames(dates_use) <- 1:nrow(dates_use)
dates_use <- dates_use[-13:-28,]
rownames(dates_use) <- 1:nrow(dates_use)
dates_use <- dates_use[-33:-40,]

# Remove outliers
dates_use <- dates_use[-which(dates_use$ID == "W20"),]



# Add CRDS metrics
for(k in 1:nrow(dates_use)){
  ID <- dates_use$ID[k]
  rowUse <- which(crds.rem$ID == ID)
  dates_use$AvgDelta[k] <- crds.rem$AvgDelta[rowUse]
  dates_use$MaxD[k] <- crds.rem$MaxD[rowUse]
  dates_use$MaxSlope[k] <- crds.rem$MaxSlope[rowUse]
  dates_use$AUC_sqrt[k] <- crds.rem$AUC_sqrt[rowUse]
  dates_use$Baseline[k] <- crds.rem$Baseline[rowUse]
}
  
# Separate by Season
dates.spr <- dates_use[which(dates_use$Season == "Spring"),]
dates.win <- dates_use[which(dates_use$Season == "Winter"),]



### Spring
res <- resid(lm(Days_Hib ~ Antibiotics, dates.spr))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
var.test(Days_Hib ~ Antibiotics, dates.spr)
  # p-value = 0.9201
t.test(Days_Hib ~ Antibiotics, dates.spr)
  # p = 0.1215


res <- resid(lm(IBA.Hib ~ Antibiotics, dates.spr))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
var.test(IBA.Hib ~ Antibiotics, dates.spr)
  # p-value = 0.9449
t.test(IBA.Hib ~ Antibiotics, dates.spr)
  # p = 0.9588


res <- resid(lm(Num_IBA ~ Antibiotics, dates.spr))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
var.test(Num_IBA ~ Antibiotics, dates.spr)
  # p-value = 0.5191
t.test(Num_IBA ~ Antibiotics, dates.spr)
  # p = 0.4637



### Winter
res <- resid(lm(Days_Hib ~ Antibiotics, dates.win))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
var.test(Days_Hib ~ Antibiotics, dates.win)
  # p-value = 0.1999
t.test(Days_Hib ~ Antibiotics, dates.win)
  # p = 0.01295


res <- resid(lm(IBA.Hib ~ Antibiotics, dates.win))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
var.test(IBA.Hib ~ Antibiotics, dates.win)
  # p-value = 0.3048
t.test(IBA.Hib ~ Antibiotics, dates.win)
  # p = 0.4024


res <- resid(lm(Num_IBA ~ Antibiotics, dates.win))
hist(res)
qqnorm(res)
qqline(res)
shapiro.test(res)
  # Normal
var.test(Num_IBA ~ Antibiotics, dates.win)
  # p-value = 0.8388
t.test(Num_IBA ~ Antibiotics, dates.win)
  # p = 0.469

```
