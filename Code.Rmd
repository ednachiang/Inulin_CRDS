---
title: "Code"
author: "Edna Chiang"
date: "February 5, 2018"
output: html_document
---

### Load Packages, scripts, and functions
```{r}
library(ggplot2)
library(dplyr)
library(grid)
library(MESS)
library(pgirmess)
library(Bolstad2)
source('scripts/import_crds.R')
source('scripts/import_crds_sep.R')
source('scripts/bin_crds.R')
source('scripts/misc.R')
set.seed(1)
theme_set(theme_bw())

### Stats Notes
# Use 'subset' in kruskal.test
# Do NOT use 'subset' in kruskalmc or pairwise.wilcox.test; it doesn't work!
```

### Load Data
```{r}
crds <- import.crds('CSV', 'metadata.csv')
crds.all <- import.crds.sep('CSV', 'metadata.csv')
```

### Bin RelTime
```{r}
crds.bin <- bin.crds(crds)
```

### Summarize by Substrate + ABX
```{r}
# Remove NA's (gavage time)
rem <- which(is.na(crds.bin$Delta))
crds.rem <- crds.bin[-rem,]

# Remove 3982 because it may be incorrectly labeled
crds.rem <- crds.rem[-which(crds.rem$Number == 3982),]
crds.rem$ID <- droplevels(crds.rem$ID)

# Summarize
crds.sum <- crds.rem %>%
  group_by(Substrate, Antibiotics, Season, BinTime) %>%
  summarize(Mean = mean(Delta),
            Median = median(Delta),
            SD = sd(Delta),
            SE = se(Delta),
            iqr = IQR(Delta))
crds.sum$Season <- ordered(crds.sum$Season, levels=c("Summer", "Winter", "Spring"))
```

### Separate by substrate
```{r}
inu.all <- crds.sum[which(crds.sum$Substrate == "Inulin"),]

man.all <- crds.sum[which(crds.sum$Substrate == "Mannitol"),]

sal.all <- crds.sum[which(crds.sum$Substrate == "Saline"),]

ure.all <- crds.sum[which(crds.sum$Substrate == "Urea"),]
```


### Plot
```{r}
## All individuals
ggplot(crds.bin, aes(x=BinTime, y=Delta, color=ID)) +
  geom_line() +
  geom_point()

## Substrate/ABX
ggplot(crds.sum, aes(x=BinTime, y=Mean, color=Substrate)) +
  geom_line(aes(linetype=Antibiotics)) +
  geom_point() +
  geom_errorbar(aes(ymin = Mean-SE, ymax = Mean+SE))

## Inulin
inu.plot <- ggplot(inu.all, aes(x=BinTime, y=Mean, color=Season)) +
  geom_line(aes(linetype=Antibiotics), size=1) +
   geom_point(size=3, shape=21, aes(color=Season, fill=factor(ifelse(Antibiotics == "Yes", NA, Season)))) +
  scale_color_manual(name="Season", values=c("darkgoldenrod2", "dodgerblue3", "green3")) +
  scale_fill_manual(values=c("darkgoldenrod2", "dodgerblue3", "green3"), na.value="white", guide="none") +
  geom_errorbar(aes(ymin = Mean-SE, ymax = Mean+SE), width=0.125, position=position_dodge(0.1)) +
  ggtitle(expression("Inulin"~~delta^13~"C")) +
  xlab("Time Since Gavage") +
  ylab(expression("Mean"~~delta^13~"C"))+
  theme(plot.title=element_text(hjust=0.5, size=12),
        axis.title.x=element_text(size=12),
        axis.title.y=element_text(size=12)) +
  guides(colour=F, linetype=F)

## Mannitol
man.plot <- ggplot(man.all, aes(x=BinTime, y=Mean, color=Season)) +
  geom_line(aes(linetype=Antibiotics), size=1) +
  geom_point(size=3, shape=21, aes(color=Season, fill=factor(ifelse(Antibiotics == "Yes", NA, Season)))) +
  scale_color_manual(name="Season", values=c("darkgoldenrod2", "dodgerblue3", "green3")) +
  scale_fill_manual(values=c("darkgoldenrod2", "dodgerblue3", "green3"), na.value="white", guide="none") +
  geom_errorbar(aes(ymin = Mean-SE, ymax = Mean+SE), width=0.125, position=position_dodge(0.1)) +
  ggtitle(expression("Mannitol"~~delta^13~"C")) +
  xlab("Time Since Gavage") +
  ylab(expression("Mean"~~delta^13~"C"))+
  theme(plot.title=element_text(hjust=0.5, size=12),
        axis.title.x=element_text(size=12),
        axis.title.y=element_text(size=12)) +
  guides(colour=F, linetype=F)

## Saline
sal.plot <- ggplot(sal.all, aes(x=BinTime, y=Mean, color=Season)) +
  geom_line(aes(linetype=Antibiotics), size=1) +
  geom_point(size=3, shape=21, aes(color=Season, fill=factor(ifelse(Antibiotics == "Yes", NA, Season)))) +
  scale_color_manual(name="Season", values=c("darkgoldenrod2", "dodgerblue3", "green3")) +
  scale_fill_manual(values=c("darkgoldenrod2", "dodgerblue3", "green3"), na.value="white", guide="none") +
  geom_errorbar(aes(ymin = Mean-SE, ymax = Mean+SE), width=0.125, position=position_dodge(0.1)) +
  ggtitle(expression("Saline"~~delta^13~"C")) +
  xlab("Time Since Gavage") +
  ylab(expression("Mean"~~delta^13~"C"))+
  theme(plot.title=element_text(hjust=0.5, size=12),
        axis.title.x=element_text(size=12),
        axis.title.y=element_text(size=12)) +
  guides(colour=F, linetype=F)

## Urea
ure.plot <- ggplot(ure.all, aes(x=BinTime, y=Mean, color=Season)) +
  geom_line(aes(linetype=Antibiotics), size=1) +
  geom_point(size=3, shape=21, aes(color=Season, fill=factor(ifelse(Antibiotics == "Yes", NA, Season)))) +
  scale_color_manual(name="Season", values=c("darkgoldenrod2", "dodgerblue3", "green3")) +
  scale_fill_manual(values=c("darkgoldenrod2", "dodgerblue3", "green3"), na.value="white", guide="none") +
  geom_errorbar(aes(ymin = Mean-SE, ymax = Mean+SE), width=0.125, position=position_dodge(0.1)) +
  ggtitle(expression("Urea"~~delta^13~"C")) +
  xlab("Time Since Gavage") +
  ylab(expression("Mean"~~delta^13~"C"))+
  theme(plot.title=element_text(hjust=0.5)) #+
  #guides(colour=F, linetype=F)

## Steal legend
steal.legend <- ggplot(sal.all, aes(x=BinTime, y=Mean, color=Season)) +
  geom_line(aes(linetype=Antibiotics), size=1) +
  geom_point(size=3) +
  scale_color_manual(name="Season", values=c("darkgoldenrod2", "dodgerblue3", "green3")) +
  geom_errorbar(aes(ymin = Mean-SE, ymax = Mean+SE), width=0.125, position=position_dodge(0.1)) +
  ggtitle(expression("Saline"~~delta^13~"C")) +
  xlab("Time Since Gavage") +
  ylab(expression("Mean"~~delta^13~"C"))+
  theme(plot.title=element_text(hjust=0.5))
legend <- g_legend(steal.legend)
```


### Poster Plots
```{r}
tiff("prelim.fig3.tiff", width = 9, height = 3.5, units = "in", res = 300)
grid.newpage()
pushViewport(viewport(layout=(grid.layout(1,4, widths=c(1,1,1,0.4), heights=c(1,1,1,1)))))
print(inu.plot, vp=viewport(layout.pos.row=1, layout.pos.col=1))
print(man.plot, vp=viewport(layout.pos.row=1, layout.pos.col=2))
print(sal.plot, vp=viewport(layout.pos.row=1, layout.pos.col=3))
legend$vp <- viewport(layout.pos.row=1, layout.pos.col=4)
grid.draw(legend)
dev.off()

```


### Inulin Plots
```{r}
## All individuals
inu.ind <- crds.rem[which(crds.rem$Substrate == "Inulin"),]
ggplot(inu.ind, aes(x=BinTime, y=Delta, color=Season)) +
  geom_line(aes(linetype=ABX)) +
  geom_point() +
  scale_color_manual(name="Season", values=c("red", "Blue"))

## Summer
inu.sum <- crds.rem[which(crds.rem$Substrate == "Inulin" & crds.rem$Season == "Summer"),]
ggplot(inu.sum, aes(x=BinTime, y=Delta, color=ABX)) +
  geom_line(aes(linetype=ABX)) +
  geom_point() +
  scale_color_manual(name="ABX", values=c("red", "Blue"))

## Summer ABX
inu.sum.abx <- crds.rem[which(crds.rem$Substrate == "Inulin" & crds.rem$Season == "Summer" & crds.rem$ABX == "Yes"),]
ggplot(inu.sum.abx, aes(x=BinTime, y=Delta, color=ID)) +
  geom_line(aes(linetype=ABX)) +
  geom_point()
  # 3982 is an outlier -- is it actually ABX?
  # Until confirmed, remove from data
```


### AUC
```{r}
# AUC = Area Under Curve
# https://stackoverflow.com/questions/4954507/calculate-the-area-under-a-curve

### Remove unwanted substrates
crds.auc <- crds.rem[-which(crds.rem$Substrate == "Urea"),]
crds.auc <- crds.auc[-which(crds.auc$Substrate == "Acetate"),]
crds.auc$Substrate <- droplevels(crds.auc$Substrate)
crds.auc$ID <- droplevels(crds.auc$ID)

### Calculate AUC
ids <- levels(crds.auc$ID)
auc.df <- data.frame(crds.auc[1,])
auc.df <- auc.df[,-2:-3]
auc.df <- auc.df[,-8]
colnames(auc.df) <- c("AUC", "Number", "ID", "Season", "Sex", "Antibiotics", "Substrate")
for(i in 1:length(ids)){
  ID <- ids[i]
  select <- crds.auc[which(crds.auc$ID == ID),]
  baseline <- which(select$RelTime < 0)
  baseline.reltime <- mean(select$RelTime[baseline])
  baseline.delta <- mean(select$Delta[baseline])
  baseline.co2 <- mean(select$CO2[baseline])
  baseline.bintime <- mean(select$BinTime[baseline])
  select.norm <- data.frame(RelTime=baseline.reltime, Delta=0, CO2=baseline.co2,
                            Number=select$Number[1], ID=select$ID[1], Season=select$Season[1],
                            Sex=select$Sex[1], Antibiotics=select$Antibiotics[1],
                            Substrate=select$Substrate[1], BinTime=baseline.bintime)
    # Delta = 0 because we want to normalize everything to baseline. Any neg Deltas will decrease the AUC (subtracted from AUC), which is not what we want.
  exp <- which(select$RelTime>0)
  for(j in 1:(nrow(select)-length(baseline))){
    select.norm[j+1,] <- select[exp[j],]
  }
  select.norm[2:nrow(select.norm),2] <- (select.norm[2:nrow(select.norm),2]-baseline.delta)
  x <- select.norm$RelTime
  y <- select.norm$Delta
  AUC <- auc(x, y, type = 'spline')
  auc.df[i,1] <- AUC
  auc.df[i,2:7] <- select.norm[1,4:9]
}

### Subset by Substrate & ABX
auc.inu <- auc.df[which(auc.df$Substrate == "Inulin"),]
auc.man <- auc.df[which(auc.df$Substrate == "Mannitol"),]
auc.sal <- auc.df[which(auc.df$Substrate == "Saline"),]
auc.abx <- auc.df[which(auc.df$Antibiotics == "Yes"),]
auc.noabx <- auc.df[which(auc.df$Antibiotics == "No"),]
auc.inu.abx <- auc.inu[which(auc.inu$Antibiotics == "Yes"),]
auc.inu.noabx <- auc.inu[which(auc.inu$Antibiotics == "No"),]
auc.man.abx <- auc.man[which(auc.man$Antibiotics == "Yes"),]
auc.man.noabx <- auc.man[which(auc.man$Antibiotics == "No"),]
auc.sal.abx <- auc.sal[which(auc.sal$Antibiotics == "Yes"),]
auc.sal.noabx <- auc.sal[which(auc.sal$Antibiotics == "No"),]

### Check Normality
hist(auc.df$AUC)
qqnorm(auc.df$AUC)
qqline(auc.df$AUC)
shapiro.test(auc.df$AUC)
  # p-value = 5.601e-15
  # Not Normal

hist(auc.inu$AUC)
qqnorm(auc.inu$AUC)
qqline(auc.inu$AUC)
shapiro.test(auc.inu$AUC)
  # p-value = 0.0002643
  # Not Normal

hist(auc.man$AUC)
qqnorm(auc.man$AUC)
qqline(auc.man$AUC)
shapiro.test(auc.man$AUC)
  # p-value = 1.582e-08
  # Not Normal

hist(auc.sal$AUC)
qqnorm(auc.sal$AUC)
qqline(auc.sal$AUC)
shapiro.test(auc.sal$AUC)
  # p-value = 4.957e-05
  # Not Normal

hist(auc.abx$AUC)
qqnorm(auc.abx$AUC)
qqline(auc.abx$AUC)
shapiro.test(auc.abx$AUC)
  # p-value = 3.16e-08
  # Not Normal

hist(auc.noabx$AUC)
qqnorm(auc.noabx$AUC)
qqline(auc.noabx$AUC)
shapiro.test(auc.noabx$AUC)
  # p-value = 2.481e-09
  # Not Normal



### Boxplots
ggplot(auc.df, aes(x=Season, y=AUC, fill = Antibiotics)) +
  geom_boxplot(position=position_dodge(1)) +
  geom_point() + 
  facet_grid(.~Substrate) 
ggplot(auc.inu, aes(x=Season, y=AUC, fill = Antibiotics)) +
  geom_boxplot(position=position_dodge(1)) +
  geom_point()
ggplot(auc.man, aes(x=Season, y=AUC, fill = Antibiotics)) +
  geom_boxplot(position=position_dodge(1)) +
  geom_point()
ggplot(auc.sal, aes(x=Season, y=AUC, fill = Antibiotics)) +
  geom_boxplot(position=position_dodge(1)) +
  geom_point()



### Kruskal-Wallis
wilcox.test(AUC~Antibiotics, data=auc.df)
  # p-value = 0.0008937
kruskal.test(formula = AUC ~ Substrate, data=auc.abx)
  # p-value = 8.831e-07
kruskalmc(resp = AUC ~ Substrate, data=auc.abx)
  # Inulin-Mannitol
  # Inulin-Saline
  # Mannitol-Saline
kruskal.test(formula = AUC ~ Season, data=auc.abx)
  # p-value = 0.1231

# Inulin
wilcox.test(AUC~Antibiotics, data=auc.inu)
  # p-value = 0.0001171
kruskal.test(formula = AUC ~ Season, data=auc.inu.abx)
  # p-value = 0.9168
kruskal.test(formula = AUC ~ Season, data=auc.inu.noabx)
  # p-value = 0.09011

# Mannitol
wilcox.test(AUC~Antibiotics, data=auc.man)
  # p-value = 7.173e-05
kruskal.test(formula = AUC ~ Season, data=auc.man.abx)
  # p-value = 0.8836
kruskal.test(formula = AUC ~ Season, data=auc.man.noabx)
  # p-value = 0.2792

# Saline
wilcox.test(AUC~Antibiotics, data=auc.sal)
  # p-value = 0.0001171
kruskal.test(formula = AUC ~ Season, data=auc.sal.abx)
  # p-value = 0.06287
kruskal.test(formula = AUC ~ Season, data=auc.sal.noabx)
  # p-value = 0.6906




### Kruskal-Wallis BH-adjusted p-values
# Within-substrate ABX wilcoxon test
p.adjust(c(0.0001171, 7.173e-05, 0.0001171), method="BH")
  # Inulin = 0.0001171
  # Mannitol = 0.0001171
  # Saline = 0.0001171
# Within-substrate season kruskal-wallis test
p.adjust(c(0.9168, 0.09011, 0.8836, 0.2792, 0.06287, 0.6906), method="BH")
  # Inulin ABX = 0.91680
  # Inulin No ABX = 0.27033
  # Mannitol ABX = 0.91680
  # Mannitol No ABX = 0.55840
  # Saline ABX = 0.27033
  # Saline No ABX = 0.91680

```


### AUC 2
```{r}
# https://stackoverflow.com/questions/4954507/calculate-the-area-under-a-curve

### Remove unwanted substrates
crds.auc <- crds.rem[-which(crds.rem$Substrate == "Urea"),]
crds.auc <- crds.auc[-which(crds.auc$Substrate == "Acetate"),]
crds.auc$Substrate <- droplevels(crds.auc$Substrate)
crds.auc$ID <- droplevels(crds.auc$ID)

### Calculate AUC 2
ids <- levels(crds.auc$ID)
auc2.df <- data.frame(crds.auc[1,])
auc2.df <- auc2.df[,-2:-3]
auc2.df <- auc2.df[,-8]
colnames(auc2.df) <- c("AUC", "Number", "ID", "Season", "Sex", "Antibiotics", "Substrate")
for(i in 1:length(ids)){
  ID <- ids[i]
  print(ID)
  select <- crds.auc[which(crds.auc$ID == ID),]
  baseline <- which(select$RelTime < 0)
  baseline.reltime <- mean(select$RelTime[baseline])
  baseline.delta <- mean(select$Delta[baseline])
  baseline.co2 <- mean(select$CO2[baseline])
  baseline.bintime <- mean(select$BinTime[baseline])
  select.norm <- data.frame(RelTime=baseline.reltime, Delta=0, CO2=baseline.co2,
                            Number=select$Number[1], ID=select$ID[1], Season=select$Season[1],
                            Sex=select$Sex[1], Antibiotics=select$Antibiotics[1],
                            Substrate=select$Substrate[1], BinTime=baseline.bintime)
      # Delta = 0 because we want to normalize everything to baseline. Any neg Deltas will decrease the AUC (subtracted from AUC), which is not what we want.
  exp <- which(select$RelTime>0)
  for(j in 1:(nrow(select)-length(baseline))){
    select.norm[j+1,] <- select[exp[j],]
  }
  select.norm[2:nrow(select.norm),2] <- (select.norm[2:nrow(select.norm),2]-baseline.delta)
  x <- select.norm$RelTime
  y <- select.norm$Delta
  AUC <- sintegral(x,y)$int
  print(AUC)
  auc2.df[i,1] <- AUC
  auc2.df[i,2:7] <- select.norm[1,4:9]
}



### Compare AUC1 vs. AUC2
auc.comp <- auc.df
auc.comp[((nrow(auc.df)+1):(nrow(auc.df)+nrow(auc2.df))),] <- auc2.df
auc.comp$Test <- c(rep("Spline",88), rep("Simpson",88))
wilcox.test(AUC~Test, data=auc.comp)
  # p-value = 0.8003



### Subset by Substrate & ABX
auc2.inu <- auc2.df[which(auc2.df$Substrate == "Inulin"),]
auc2.man <- auc2.df[which(auc2.df$Substrate == "Mannitol"),]
auc2.sal <- auc2.df[which(auc2.df$Substrate == "Saline"),]
auc2.abx <- auc2.df[which(auc2.df$Antibiotics == "Yes"),]
auc2.noabx <- auc2.df[which(auc2.inu$Antibiotics == "No"),]
auc2.inu.abx <- auc2.inu[which(auc2.inu$Antibiotics == "Yes"),]
auc2.inu.noabx <- auc2.inu[which(auc2.inu$Antibiotics == "No"),]
auc2.man.abx <- auc2.man[which(auc2.man$Antibiotics == "Yes"),]
auc2.man.noabx <- auc2.man[which(auc2.man$Antibiotics == "No"),]
auc2.sal.abx <- auc2.sal[which(auc2.sal$Antibiotics == "Yes"),]
auc2.sal.noabx <- auc2.sal[which(auc2.sal$Antibiotics == "No"),]


### Check Normality
hist(auc2.df$AUC)
qqnorm(auc2.df$AUC)
qqline(auc2.df$AUC)
shapiro.test(auc2.df$AUC)
  # p-value = 6.356e-15
  # Not Normal

hist(auc2.inu$AUC)
qqnorm(auc2.inu$AUC)
qqline(auc2.inu$AUC)
shapiro.test(auc2.inu$AUC)
  # p-value = 0.0002609
  # Not Normal

hist(auc2.man$AUC)
qqnorm(auc2.man$AUC)
qqline(auc2.man$AUC)
shapiro.test(auc2.man$AUC)
  # p-value = 1.17e-08
  # Not Normal

hist(auc2.sal$AUC)
qqnorm(auc2.sal$AUC)
qqline(auc2.sal$AUC)
shapiro.test(auc2.sal$AUC)
  # p-value = 0.0001006
  # Not Normal

hist(auc2.abx$AUC)
qqnorm(auc2.abx$AUC)
qqline(auc2.abx$AUC)
shapiro.test(auc2.abx$AUC)
  # p-value = 3.136e-08
  # Not Normal

hist(auc2.noabx$AUC)
qqnorm(auc2.noabx$AUC)
qqline(auc2.noabx$AUC)
shapiro.test(auc2.noabx$AUC)
  # p-value = 2.767e-09
  # Not Normal



### Boxplots
ggplot(auc2.df, aes(x=Season, y=AUC, fill = Antibiotics)) +
  geom_boxplot(position=position_dodge(1)) +
  geom_point() + 
  facet_grid(.~Substrate) 
ggplot(auc2.inu, aes(x=Season, y=AUC, fill = Antibiotics)) +
  geom_boxplot(position=position_dodge(1)) +
  geom_point()
ggplot(auc2.man, aes(x=Season, y=AUC, fill = Antibiotics)) +
  geom_boxplot(position=position_dodge(1)) +
  geom_point()
ggplot(auc2.sal, aes(x=Season, y=AUC, fill = Antibiotics)) +
  geom_boxplot(position=position_dodge(1)) +
  geom_point()



### Kruskal-Wallis
wilcox.test(AUC~Antibiotics, data=auc2.df)
  # p-value = 0.001071
kruskal.test(formula = AUC ~ Substrate, data=auc2.abx)
  # p-value = 7.341e-07
kruskalmc(resp = AUC ~ Substrate, data=auc2.abx)
  # Inulin-Mannitol
  # Inulin-Saline
  # Mannitol-Saline
kruskal.test(formula = AUC ~ Season, data=auc2.abx)
  # p-value = 0.1093

# Inulin
wilcox.test(AUC~Antibiotics, data=auc2.inu)
  # p-value = 0.0001171
kruskal.test(formula = AUC ~ Season, data=auc2.inu.abx)
  # p-value = 0.9168
kruskal.test(formula = AUC ~ Season, data=auc2.inu.noabx)
  # p-value = 0.06794

# Mannitol
wilcox.test(AUC~Antibiotics, data=auc2.man)
  # p-value = 7.173e-05
kruskal.test(formula = AUC ~ Season, data=auc2.man.abx)
  # p-value = 0.7697
kruskal.test(formula = AUC ~ Season, data=auc2.man.noabx)
  # p-value = 0.2523

# Saline
wilcox.test(AUC~Antibiotics, data=auc2.sal)
  # p-value = 0.02334
kruskal.test(formula = AUC ~ Season, data=auc2.sal.abx)
  # p-value = 0.05411
kruskal.test(formula = AUC ~ Season, data=auc2.sal.noabx)
  # p-value = 0.07628




### Kruskal-Wallis BH-adjusted p-values
# Within-substrate ABX wilcoxon test
p.adjust(c(0.0001171, 7.173e-05, 0.02334), method="BH")
  # Inulin = 0.00017565
  # Mannitol = 0.00017565
  # Saline = 0.02334000
# Within-substrate season kruskal-wallis test
p.adjust(c(0.9168, 0.06794, 0.7697, 0.2523, 0.05411, 0.07628), method="BH")
  # Inulin ABX = 0.9168
  # Inulin No ABX = 0.15256
  # Mannitol ABX = 0.91680
  # Mannitol No ABX = 0.37845
  # Saline ABX = 0.15256
  # Saline No ABX = 0.15256
```


### Max Val
```{r}
### Remove unwanted substrates
crds.max <- crds.rem[-which(crds.rem$Substrate == "Urea"),]
crds.max <- crds.max[-which(crds.max$Substrate == "Acetate"),]
crds.max$Substrate <- droplevels(crds.max$Substrate)
crds.max$ID <- droplevels(crds.max$ID)

### Pull out max delta value
ids <- levels(crds.max$ID)
max.df <- data.frame(crds.max[1,])
max.df <- max.df[,-2:-3]
max.df <- max.df[,-8]
colnames(max.df) <- c("Delta", "Number", "ID", "Season", "Sex", "Antibiotics", "Substrate")
select.max <- data.frame(Delta=NA, RelTime=NA, Number=NA, ID=NA,
                         Season=NA, Sex=NA,
                         Antibiotics=NA, Substrate=NA)
for(i in 1:length(ids)){
  ID <- ids[i]
  print(ID)
  select <- crds.max[which(crds.max$ID == ID),]
  Max <- max(select$Delta)
  Max.time <- select$RelTime[which(select$Delta == max(select$Delta))]
  select.max[i,1:3] <- c(Max, Max.time, select$Number[1])
  select.max[i, 4] <- as.character(select$ID[1])
  select.max[i, 5] <- as.character(select$Season[1])
  select.max[i, 6] <- as.character(select$Sex[1])
  select.max[i, 7] <- as.character(select$Antibiotics[1])
  select.max[i, 8] <- as.character(select$Substrate[1])
}










### Subset by Substrate & ABX
auc.inu <- auc.df[which(auc.df$Substrate == "Inulin"),]
auc.man <- auc.df[which(auc.df$Substrate == "Mannitol"),]
auc.sal <- auc.df[which(auc.df$Substrate == "Saline"),]
auc.abx <- auc.df[which(auc.df$Antibiotics == "Yes"),]
auc.noabx <- auc.df[which(auc.df$Antibiotics == "No"),]
auc.inu.abx <- auc.inu[which(auc.inu$Antibiotics == "Yes"),]
auc.inu.noabx <- auc.inu[which(auc.inu$Antibiotics == "No"),]
auc.man.abx <- auc.man[which(auc.man$Antibiotics == "Yes"),]
auc.man.noabx <- auc.man[which(auc.man$Antibiotics == "No"),]
auc.sal.abx <- auc.sal[which(auc.sal$Antibiotics == "Yes"),]
auc.sal.noabx <- auc.sal[which(auc.sal$Antibiotics == "No"),]

### Check Normality
hist(auc.df$AUC)
qqnorm(auc.df$AUC)
qqline(auc.df$AUC)
shapiro.test(auc.df$AUC)
  # p-value = 5.601e-15
  # Not Normal

hist(auc.inu$AUC)
qqnorm(auc.inu$AUC)
qqline(auc.inu$AUC)
shapiro.test(auc.inu$AUC)
  # p-value = 0.0002643
  # Not Normal

hist(auc.man$AUC)
qqnorm(auc.man$AUC)
qqline(auc.man$AUC)
shapiro.test(auc.man$AUC)
  # p-value = 1.582e-08
  # Not Normal

hist(auc.sal$AUC)
qqnorm(auc.sal$AUC)
qqline(auc.sal$AUC)
shapiro.test(auc.sal$AUC)
  # p-value = 4.957e-05
  # Not Normal

hist(auc.abx$AUC)
qqnorm(auc.abx$AUC)
qqline(auc.abx$AUC)
shapiro.test(auc.abx$AUC)
  # p-value = 3.16e-08
  # Not Normal

hist(auc.noabx$AUC)
qqnorm(auc.noabx$AUC)
qqline(auc.noabx$AUC)
shapiro.test(auc.noabx$AUC)
  # p-value = 2.481e-09
  # Not Normal



### Boxplots
ggplot(auc.df, aes(x=Season, y=AUC, fill = Antibiotics)) +
  geom_boxplot(position=position_dodge(1)) +
  geom_point() + 
  facet_grid(.~Substrate) 
ggplot(auc.inu, aes(x=Season, y=AUC, fill = Antibiotics)) +
  geom_boxplot(position=position_dodge(1)) +
  geom_point()
ggplot(auc.man, aes(x=Season, y=AUC, fill = Antibiotics)) +
  geom_boxplot(position=position_dodge(1)) +
  geom_point()
ggplot(auc.sal, aes(x=Season, y=AUC, fill = Antibiotics)) +
  geom_boxplot(position=position_dodge(1)) +
  geom_point()



### Kruskal-Wallis
wilcox.test(AUC~Antibiotics, data=auc.df)
  # p-value = 0.0008937
kruskal.test(formula = AUC ~ Substrate, data=auc.abx)
  # p-value = 8.831e-07
kruskalmc(resp = AUC ~ Substrate, data=auc.abx)
  # Inulin-Mannitol
  # Inulin-Saline
  # Mannitol-Saline
kruskal.test(formula = AUC ~ Season, data=auc.abx)
  # p-value = 0.1231

# Inulin
wilcox.test(AUC~Antibiotics, data=auc.inu)
  # p-value = 0.0001171
kruskal.test(formula = AUC ~ Season, data=auc.inu.abx)
  # p-value = 0.9168
kruskal.test(formula = AUC ~ Season, data=auc.inu.noabx)
  # p-value = 0.09011

```

### ANOVA
```{r}

```


